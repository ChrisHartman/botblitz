import copy
from blitz_env import is_drafted, simulate_draft, visualize_draft_board, Player, GameState, AddDropSelection
from typing import List
import collections
import os
import importlib
import base64
import re

borrowed_bots = [b'ZnJvbSBibGl0el9lbnYgaW1wb3J0IGlzX2RyYWZ0ZWQsIHNpbXVsYXRlX2RyYWZ0LCB2aXN1YWxpemVfZHJhZnRfYm9hcmQsIFBsYXllciwgR2FtZVN0YXRlLCBTdGF0c0RCLCBQcm9qZWN0aW9uc0RCCmZyb20gdHlwaW5nIGltcG9ydCBMaXN0CmltcG9ydCBtYXRoCgpkZWYgZ2V0X3BvaW50c193ZWVrXzEoc3RhdHNfZGIsIHBsYXllciwgeWVhcik6CiAgICB3ZWVrbHlfZGYgPSBzdGF0c19kYi5nZXRfd2Vla2x5X2RhdGEocGxheWVyKQogICAgdHJ5OgogICAgICByZXR1cm4gd2Vla2x5X2RmWyh3ZWVrbHlfZGZbIndlZWsiXSA9PSAxKSAmICh3ZWVrbHlfZGZbInNlYXNvbiJdID09IHllYXIpXVsiZmFudGFzeV9wb2ludHNfcHByIl0uaWxvY1swXQogICAgZXhjZXB0OgogICAgICByZXR1cm4gMAoKZGVmIGdldF9wcmVzZWFzb25fcHJvamVjdGlvbnMocHJvamVjdGlvbnNfZGIsIHBsYXllciwgeWVhcik6CiAgICB0cnk6CiAgICAgICAgcmV0dXJuIHByb2plY3Rpb25zX2RiLmdldF9wcmVzZWFzb25fcHJvamVjdGlvbnMocGxheWVyLCBzZWFzb249eWVhcilbIk1JU0NfRlBUUyJdLmlsb2NbMF0KICAgIGV4Y2VwdDoKICAgICAgICByZXR1cm4gMAoKZGVmIGdldF93ZWVrXzJfcHJvamVjdGlvbnMocHJvamVjdGlvbnNfZGIsIHBsYXllciwgeWVhcik6CiAgICB0cnk6CiAgICAgICAgcmV0dXJuIHByb2plY3Rpb25zX2RiLmdldF93ZWVrbHlfcHJvamVjdGlvbnMocGxheWVyLCBzZWFzb249eWVhciwgd2Vlaz0yKVsiTUlTQ19GUFRTIl0uaWxvY1swXQogICAgZXhjZXB0OgogICAgICAgIHJldHVybiAwCgpwbGF5ZXJfZXhwZWN0ZWRfcG9pbnRzID0gTm9uZQoKZGVmIGRyYWZ0X3BsYXllcihnYW1lX3N0YXRlOiBHYW1lU3RhdGUpIC0+IHN0cjoKICAgICIiIgogICAgU2VsZWN0cyBhIHBsYXllciB0byBkcmFmdCBiYXNlZCBvbiB0aGUgaGlnaGVzdCByYW5rLgoKICAgIEFyZ3M6CiAgICAgICAgcGxheWVycyAoTGlzdFtQbGF5ZXJdKTogQSBsaXN0IG9mIFBsYXllciBvYmplY3RzLgoKICAgIFJldHVybnM6CiAgICAgICAgc3RyOiBUaGUgaWQgb2YgdGhlIGRyYWZ0ZWQgcGxheWVyLgogICAgIiIiCiAgICAjIEZpbHRlciBvdXQgYWxyZWFkeSBkcmFmdGVkIHBsYXllcnMKICAgIHVuZHJhZnRlZF9wbGF5ZXJzID0gW3BsYXllciBmb3IgcGxheWVyIGluIGdhbWVfc3RhdGUucGxheWVycyBpZiBub3QgaXNfZHJhZnRlZChwbGF5ZXIpXQoKICAgICMgRmluZCBwbGF5ZXJzIGN1cnJlbnRseSBvbiB0ZWFtCiAgICB0ZWFtX3BsYXllcnMgPSBbcGxheWVyIGZvciBwbGF5ZXIgaW4gZ2FtZV9zdGF0ZS5wbGF5ZXJzIGlmIHBsYXllci5zdGF0dXMuY3VycmVudF9mYW50YXN5X3RlYW1faWQgPT0gZ2FtZV9zdGF0ZS5jdXJyZW50X2JvdF90ZWFtX2lkXQoKICAgIGRlZiBnZXRfZXhwZWN0ZWRfcG9pbnRzKHN0YXRzX2RiLCBwcm9qZWN0aW9uc19kYiwgcGxheWVyKToKICAgICAgICBwcmVzZWFzb25fcHJvamVjdGlvbnMgPSBnZXRfcHJlc2Vhc29uX3Byb2plY3Rpb25zKHByb2plY3Rpb25zX2RiLCBwbGF5ZXIsIGdhbWVfc3RhdGUubGVhZ3VlX3NldHRpbmdzLnllYXIpCiAgICAgICAgd2Vla18yX3Byb2plY3Rpb25zID0gZ2V0X3dlZWtfMl9wcm9qZWN0aW9ucyhwcm9qZWN0aW9uc19kYiwgcGxheWVyLCBnYW1lX3N0YXRlLmxlYWd1ZV9zZXR0aW5ncy55ZWFyKQogICAgICAgIHdlZWtfMV9wb2ludHMgPSBnZXRfcG9pbnRzX3dlZWtfMShzdGF0c19kYiwgcGxheWVyLCBnYW1lX3N0YXRlLmxlYWd1ZV9zZXR0aW5ncy55ZWFyKQogICAgICAgICMgdGFrZSB0aGUgYXZlcmFnZSBvZiBwcmVzZWFzb25fcHJvamVjdGlvbnMsIHdlZWtfMl9wcm9qZWN0aW9ucyoxNywgYW5kIHdlZWtfMV9wb2ludHMqMTcgYXMgdGhlIHByb2plY3RlZCBwb2ludHMKICAgICAgICBleHBlY3RlZF9wb2ludHMgPSAocHJlc2Vhc29uX3Byb2plY3Rpb25zICsgd2Vla18yX3Byb2plY3Rpb25zKjE3ICsgd2Vla18xX3BvaW50cyoxNykgLyAzLjAKICAgICAgICByZXR1cm4gZXhwZWN0ZWRfcG9pbnRzCgogICAgIyBUaGlzIGlzIHRoZSBleHBlbnNpdmUgQVBJIGNhbGxzLiAgSXQgbmVlZHMgdG8gYmUgZG9uZSBhdCBsZWFzdCBvbmNlLCBidXQgaW4gY2FzZSB0aGlzIGlzIHBhcnQgb2YgYSBzaW11bGF0aW9uLCBjYWNoZSB0aGUgdmFsdWVzIGZvciByZS11c2UKICAgIGdsb2JhbCBwbGF5ZXJfZXhwZWN0ZWRfcG9pbnRzCiAgICBpZiBwbGF5ZXJfZXhwZWN0ZWRfcG9pbnRzID09IE5vbmU6CiAgICAgICAgc3RhdHNfZGIgPSBTdGF0c0RCKFtnYW1lX3N0YXRlLmxlYWd1ZV9zZXR0aW5ncy55ZWFyXSkKICAgICAgICBwcm9qZWN0aW9uc19kYiA9IFByb2plY3Rpb25zREIoKQogICAgICAgIHBsYXllcl9leHBlY3RlZF9wb2ludHMgPSB7cGxheWVyLmlkOiBnZXRfZXhwZWN0ZWRfcG9pbnRzKHN0YXRzX2RiLCBwcm9qZWN0aW9uc19kYiwgcGxheWVyKSBmb3IgcGxheWVyIGluIGdhbWVfc3RhdGUucGxheWVyc30KCgogICAgZGVmIHNjb3JlX3BsYXllcihwbGF5ZXIpOgogICAgICAgIGV4cGVjdGVkX3BvaW50cyA9IHBsYXllcl9leHBlY3RlZF9wb2ludHNbcGxheWVyLmlkXQogICAgICAgICMgVXNlIGEgbXVsdGlwbGllciBiYXNlZCBvbiBjb3VudCBvZiBwb3NpdGlvbnMgdGhlIHBsYXllciBjYW4gcGxheSAtIHRoZSBwbGF5ZXJzIGF0IHRoaXMgcG9zaXRpb24gZHJhZnRlZCAqIDAuNQogICAgICAgIHBsYXllcl9wb3MgPSBwbGF5ZXIuYWxsb3dlZF9wb3NpdGlvbnNbMF0KICAgICAgICBwb3NpdGlvbl9wbGF5ZXJzX2RyYWZ0ZWQgPSBsZW4oW3AgZm9yIHAgaW4gdGVhbV9wbGF5ZXJzIGlmIHBsYXllcl9wb3MgaW4gcC5hbGxvd2VkX3Bvc2l0aW9uc10pCiAgICAgICAgcG9zaXRpb25fcGxheWVyX3Nsb3RzID0gbGVuKFtwIGZvciBwIGluIGdhbWVfc3RhdGUubGVhZ3VlX3NldHRpbmdzLnNsb3RzX3Blcl90ZWFtIGlmIHBsYXllcl9wb3MgaW4gcC5hbGxvd2VkX3BsYXllcl9wb3NpdGlvbnNdKQoKICAgICAgICBzY29yZSA9IGV4cGVjdGVkX3BvaW50cyAqIG1hdGguZXhwKHBvc2l0aW9uX3BsYXllcl9zbG90cyAtIHBvc2l0aW9uX3BsYXllcnNfZHJhZnRlZCkKICAgICAgICByYW5rID0gLTEgKiBwbGF5ZXIucmFuawogICAgICAgIHJldHVybiAoc2NvcmUsIHJhbmspCgoKICAgICMgU29ydCBiYXNlZCBvbiBwcmVjb21wdXRlZCBzY29yZXMKICAgIHVuZHJhZnRlZF9wbGF5ZXJzLnNvcnQoa2V5PWxhbWJkYSBwbGF5ZXI6IHNjb3JlX3BsYXllcihwbGF5ZXIpLCByZXZlcnNlPVRydWUpCgogICAgY3VycmVudF9yb3VuZCA9IChnYW1lX3N0YXRlLmN1cnJlbnRfZHJhZnRfcGljayAtIDEpIC8vIGxlbihnYW1lX3N0YXRlLnRlYW1zKQoKICAgICMgcHJpbnQoY3VycmVudF9yb3VuZCkKICAgICMgaW5kZXggPSAwCiAgICAjIGZvciBwbGF5ZXIgaW4gdW5kcmFmdGVkX3BsYXllcnNbMDoxMF06CiAgICAjICAgICBwcmludChpbmRleCwgcGxheWVyLmZ1bGxfbmFtZSwgcGxheWVyLmFsbG93ZWRfcG9zaXRpb25zWzBdLCBzY29yZV9wbGF5ZXIocGxheWVyKSkKICAgICMgICAgIGluZGV4ICs9IDEKICAgICMgcHJpbnQoKQogICAgIyBpZiBpdCdzIHRoZSBzZWNvbmQgdG8gbGFzdCByb3VuZCwgcGljayB0aGUgdG9wIGF2YWlsYWJsZSBraWNrZXIKICAgIHJvdW5kc19yZW1haW5pbmcgPSBnYW1lX3N0YXRlLmxlYWd1ZV9zZXR0aW5ncy50b3RhbF9yb3VuZHMgLSBjdXJyZW50X3JvdW5kCiAgICBpZiByb3VuZHNfcmVtYWluaW5nID09IDE6CiAgICAgICAgZm9yIHBsYXllciBpbiB1bmRyYWZ0ZWRfcGxheWVyczoKICAgICAgICAgICAgaWYgcGxheWVyLmFsbG93ZWRfcG9zaXRpb25zWzBdID09ICdLJzoKICAgICAgICAgICAgICAgIHJldHVybiBwbGF5ZXIuaWQKICAgIGlmIHJvdW5kc19yZW1haW5pbmcgPT0gMjoKICAgICAgICBmb3IgcGxheWVyIGluIHVuZHJhZnRlZF9wbGF5ZXJzOgogICAgICAgICAgICBpZiBwbGF5ZXIuYWxsb3dlZF9wb3NpdGlvbnNbMF0gPT0gJ0RTVCc6CiAgICAgICAgICAgICAgICByZXR1cm4gcGxheWVyLmlkCgogICAgIyBTZWxlY3QgdGhlIHBsYXllciB3aXRoIHRoZSBoaWdoZXN0IHJhbmsgKGxvd2VzdCByYW5rIG51bWJlcikKICAgIGlmIHVuZHJhZnRlZF9wbGF5ZXJzOgogICAgICAgIHJldHVybiB1bmRyYWZ0ZWRfcGxheWVyc1swXS5pZAogICAgZWxzZToKICAgICAgICByZXR1cm4gIiIgICMgUmV0dXJuIGVtcHR5IHN0cmluZyBpZiBubyB1bmRyYWZ0ZWQgcGxheWVycyBhcmUgYXZhaWxhYmxl', b'ZnJvbSBibGl0el9lbnYgaW1wb3J0IGxvYWRfcGxheWVycywgU3RhdHNEQiwgaXNfZHJhZnRlZCwgc2ltdWxhdGVfZHJhZnQsIHZpc3VhbGl6ZV9kcmFmdF9ib2FyZCwgUGxheWVyLCBHYW1lU3RhdGUKZnJvbSB0eXBpbmcgaW1wb3J0IExpc3QKaW1wb3J0IG1hdGgKaW1wb3J0IHN5cwoKUUJfUE9TID0gIlFCIgpSQl9QT1MgPSAiUkIiCldSX1BPUyA9ICJXUiIKVEVfUE9TID0gIlRFIgpLX1BPUyA9ICJLIgpEX1BPUyA9ICJEU1QiCgpkZWYgZ2V0X2RyYWZ0ZWRfdGVhbShwbGF5ZXJzLCB0ZWFtX2lkKToKICAgIHJvc3RlciA9IHsKICAgICAgICBRQl9QT1MgOiBbXSwKICAgICAgICBSQl9QT1MgOiBbXSwKICAgICAgICBXUl9QT1MgOiBbXSwKICAgICAgICBURV9QT1MgOiBbXSwKICAgICAgICBLX1BPUyA6IFtdLAogICAgICAgIERfUE9TIDogW10KICAgIH0KCiAgICBmb3IgcGxheWVyIGluIFtwbGF5ZXIgZm9yIHBsYXllciBpbiBwbGF5ZXJzIGlmIGlzX2RyYWZ0ZWQocGxheWVyKSBhbmQgcGxheWVyLnN0YXR1cy5jdXJyZW50X2ZhbnRhc3lfdGVhbV9pZCA9PSB0ZWFtX2lkXToKICAgICAgICBtYWluX3BvcyA9IHBsYXllci5hbGxvd2VkX3Bvc2l0aW9uc1swXQogICAgICAgIHJvc3RlclttYWluX3Bvc10uYXBwZW5kKHBsYXllcikKCiAgICByZXR1cm4gcm9zdGVyCgpkZWYgZ2V0X3RhcmdldF9wb3NpdGlvbnMoZHJhZnRlZF90ZWFtLCBjdXJfcm91bmQsIHRvdGFsX3JvdW5kcyk6CiAgICB0YXJnZXRfcG9zaXRpb25zID0gW10KCiAgICBpZiB0b3RhbF9yb3VuZHMgLSBjdXJfcm91bmQgPCAyOgogICAgICAgICMgTGFzdCAyIHJvdW5kcyB3ZSBnbyBmb3Iga2lja2VycyBhbmQgZGVmZW5zZQogICAgICAgIGlmIGxlbihkcmFmdGVkX3RlYW1bS19QT1NdKSA8IDE6CiAgICAgICAgICAgIHRhcmdldF9wb3NpdGlvbnMuYXBwZW5kKEtfUE9TKQoKICAgICAgICBpZiBsZW4oZHJhZnRlZF90ZWFtW0RfUE9TXSkgPCAxOgogICAgICAgICAgICB0YXJnZXRfcG9zaXRpb25zLmFwcGVuZChEX1BPUykKICAgIGVsc2U6CiAgICAgICAgcmJfY291bnQgPSBsZW4oZHJhZnRlZF90ZWFtW1JCX1BPU10pCiAgICAgICAgd3JfY291bnQgPSBsZW4oZHJhZnRlZF90ZWFtW1dSX1BPU10pCgogICAgICAgIGlmIHJiX2NvdW50IDwgNSBhbmQgKHJiX2NvdW50ICsgd3JfY291bnQpIDwgMTA6CiAgICAgICAgICAgIHRhcmdldF9wb3NpdGlvbnMuYXBwZW5kKFJCX1BPUykKCiAgICAgICAgaWYgd3JfY291bnQgPCA1IGFuZCAocmJfY291bnQgKyB3cl9jb3VudCkgPCAxMDoKICAgICAgICAgICAgdGFyZ2V0X3Bvc2l0aW9ucy5hcHBlbmQoV1JfUE9TKQoKICAgICAgICBhbGxvd2VkX3FicyA9IDIgaWYgY3VyX3JvdW5kID4gNyBlbHNlIDEgaWYgY3VyX3JvdW5kID4gMiBlbHNlIDAKICAgICAgICBpZiBjdXJfcm91bmQgPiAyIGFuZCBsZW4oZHJhZnRlZF90ZWFtW1FCX1BPU10pIDwgYWxsb3dlZF9xYnM6CiAgICAgICAgICAgIHRhcmdldF9wb3NpdGlvbnMuYXBwZW5kKFFCX1BPUykKCiAgICAgICAgaWYgY3VyX3JvdW5kID4gMyBhbmQgbGVuKGRyYWZ0ZWRfdGVhbVtURV9QT1NdKSA8IDE6CiAgICAgICAgICAgIHRhcmdldF9wb3NpdGlvbnMuYXBwZW5kKFRFX1BPUykKICAgIAogICAgcmV0dXJuIHRhcmdldF9wb3NpdGlvbnMKCmRlZiBnZXRfY3VycmVudF9yb3VuZChnYW1lX3N0YXRlOiBHYW1lU3RhdGUpIC0+IGludDoKICAgIHplcm9fYmFzZWRfcm91bmQgPSAoZ2FtZV9zdGF0ZS5jdXJyZW50X2RyYWZ0X3BpY2sgLSAxKSAvLyBsZW4oZ2FtZV9zdGF0ZS50ZWFtcykKICAgIHJldHVybiB6ZXJvX2Jhc2VkX3JvdW5kICsgMQoKZGVmIGxpc3RfdG9fbWFwKGxpc3QpOgogICAgbWFwID0ge30KICAgIGZvciBpdGVtIGluIGxpc3Q6IAogICAgICAgIG1hcFtpdGVtXSA9ICIiCiAgICAKICAgIHJldHVybiBtYXAKCmRlZiBwbGF5ZXJfbmVlZChwbGF5ZXIsIGV4aXN0aW5nX3BsYXllcnNfaW5fcG9zaXRpb24pOgogICAgb3RoZXJfcGxheWVyc19wZW5hbHR5ID0gMCBpZiBleGlzdGluZ19wbGF5ZXJzX2luX3Bvc2l0aW9uIDwgMiBlbHNlIGV4aXN0aW5nX3BsYXllcnNfaW5fcG9zaXRpb24KICAgIHBvc2l0aW9uX3JhbmtfcGVuYWx0eSA9IDIgKiAocGxheWVyLnBvc2l0aW9uX3JhbmsgLy8gNSkKICAgIHJldHVybiBwbGF5ZXIucmFuayArIG90aGVyX3BsYXllcnNfcGVuYWx0eSArIHBvc2l0aW9uX3JhbmtfcGVuYWx0eQoKZGVmIGRyYWZ0X3BsYXllcihnYW1lX3N0YXRlOiBHYW1lU3RhdGUpIC0+IHN0cjoKICAgICIiIgogICAgU2VsZWN0cyBhIHBsYXllciB0byBkcmFmdCBiYXNlZCBvbiB0aGUgaGlnaGVzdCByYW5rLgoKICAgIEFyZ3M6CiAgICAgICAgcGxheWVycyAoTGlzdFtQbGF5ZXJdKTogQSBsaXN0IG9mIFBsYXllciBvYmplY3RzLgoKICAgIFJldHVybnM6CiAgICAgICAgc3RyOiBUaGUgaWQgb2YgdGhlIGRyYWZ0ZWQgcGxheWVyLgogICAgIiIiCgogICAgcGxheWVyX2RlbnlfbWFwID0gewogICAgICAgICJNYXJ2aW4gSGFycmlzb24gSnIuIjogIiIsCiAgICAgICAgIkRyYWtlIExvbmRvbiI6ICIiLAogICAgICAgICJaYW1pciBXaGl0ZSIgOiAiIiwKICAgIH0KCiAgICAjIERvIG5vdCBkcmFmdCBUdWEgdGhpcyB5ZWFyCiAgICBpZiBnYW1lX3N0YXRlLmxlYWd1ZV9zZXR0aW5ncy55ZWFyID09IDIwMjQ6CiAgICAgICAgcGxheWVyX2RlbnlfbWFwWyJUdWEgVGFnb3ZhaWxvYSJdID0gIiIKICAgICAgICBwbGF5ZXJfZGVueV9tYXBbIlB1a2EgTmFjdWEiXSA9ICIiCgogICAgdGVhbV9kZW55X21hcCA9IHsKICAgICAgICAiQ0FSIjogIiIsCiAgICB9CgogICAgIyByZWxldmFudCBjdXJyZW50IGdhbWUgc3RhdGUKICAgIG15X3RlYW1faWQgPSBnYW1lX3N0YXRlLmN1cnJlbnRfYm90X3RlYW1faWQKICAgIGRyYWZ0ZWRfdGVhbSA9IGdldF9kcmFmdGVkX3RlYW0oZ2FtZV9zdGF0ZS5wbGF5ZXJzLCBteV90ZWFtX2lkKQogICAgY3VyX3JvdW5kID0gZ2V0X2N1cnJlbnRfcm91bmQoZ2FtZV9zdGF0ZSkKCiAgICAjIHBvc2l0aW9ucyB3ZSBhcmUgbG9va2luZyBmb3IKICAgIHRhcmdldF9wb3NpdGlvbnMgPSBnZXRfdGFyZ2V0X3Bvc2l0aW9ucyhkcmFmdGVkX3RlYW0sIGN1cl9yb3VuZCwgZ2FtZV9zdGF0ZS5sZWFndWVfc2V0dGluZ3MudG90YWxfcm91bmRzKQogICAgcG9zaXRpb25fbWFwID0gbGlzdF90b19tYXAodGFyZ2V0X3Bvc2l0aW9ucykKCiAgICAjIHBsYXllcnMgd2UgYXJlIGxvb2tpbmcgZm9yCiAgICB1bmRyYWZ0ZWRfcGxheWVycyA9IFtwbGF5ZXIgZm9yIHBsYXllciBpbiBnYW1lX3N0YXRlLnBsYXllcnMgCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCBpc19kcmFmdGVkKHBsYXllcikKICAgICAgICAgICAgICAgICAgICAgICAgYW5kIHBsYXllci5hbGxvd2VkX3Bvc2l0aW9uc1swXSBpbiBwb3NpdGlvbl9tYXAKICAgICAgICAgICAgICAgICAgICAgICAgYW5kIHBsYXllci5mdWxsX25hbWUgbm90IGluIHBsYXllcl9kZW55X21hcAogICAgICAgICAgICAgICAgICAgICAgICBhbmQgcGxheWVyLnByb2Zlc3Npb25hbF90ZWFtIG5vdCBpbiB0ZWFtX2RlbnlfbWFwXQoKCgogICAgIyBwcmludChwb3NpdGlvbl9tYXApCgogICAgIyBmb3Igayx2IGluIGRyYWZ0ZWRfdGVhbS5pdGVtcygpOgogICAgIyAgICAgcHJpbnQoayArICI6ICIgKyBzdHIobGVuKHYpKSkKCiAgICAjIGlmIGN1cl9yb3VuZCA9PSBnYW1lX3N0YXRlLmxlYWd1ZV9zZXR0aW5ncy50b3RhbF9yb3VuZHM6CiAgICAjICAgICBwcmludChkcmFmdGVkX3RlYW0pCgogICAgIyBTZWxlY3QgdGhlIHBsYXllciB3aXRoIHRoZSBoaWdoZXN0IHJhbmsgKGxvd2VzdCByYW5rIG51bWJlcikKICAgIHNlbGVjdGVkX3BsYXllciA9ICIiCiAgICBjdXJfbWluID0gc3lzLm1heHNpemUKICAgIGZvciBwbGF5ZXIgaW4gdW5kcmFmdGVkX3BsYXllcnM6CiAgICAgICAgc2NvcmUgPSBwbGF5ZXJfbmVlZChwbGF5ZXIsIGxlbihkcmFmdGVkX3RlYW1bcGxheWVyLmFsbG93ZWRfcG9zaXRpb25zWzBdXSkpCiAgICAgICAgaWYgc2NvcmUgPCBjdXJfbWluOgogICAgICAgICAgICBjdXJfbWluID0gc2NvcmUKICAgICAgICAgICAgc2VsZWN0ZWRfcGxheWVyID0gcGxheWVyLmlkCgogICAgcHJpbnQoIlNlbGVjdGluZzogIiArIHNlbGVjdGVkX3BsYXllcikKICAgIHByaW50KCJTY29yZTogIiArIHN0cihjdXJfbWluKSkKCiAgICBpZiBjdXJfcm91bmQgPT0gZ2FtZV9zdGF0ZS5sZWFndWVfc2V0dGluZ3MudG90YWxfcm91bmRzOgogICAgICAgIHByaW50KGRyYWZ0ZWRfdGVhbSkKICAgIAogICAgcmV0dXJuIHNlbGVjdGVkX3BsYXllciAgIyBSZXR1cm4gZW1wdHkgc3RyaW5nIGlmIG5vIHVuZHJhZnRlZCBwbGF5ZXJzIGFyZSBhdmFpbGFibGU=', b'ZnJvbSBibGl0el9lbnYgaW1wb3J0IGlzX2RyYWZ0ZWQsIHNpbXVsYXRlX2RyYWZ0LCB2aXN1YWxpemVfZHJhZnRfYm9hcmQsIFBsYXllciwgR2FtZVN0YXRlCmZyb20gdHlwaW5nIGltcG9ydCBMaXN0CgpkZWYgZ2V0X2N1cnJlbnRfcm91bmQoZ2FtZV9zdGF0ZTogR2FtZVN0YXRlKSAtPiBpbnQ6CiAgICB6ZXJvX2Jhc2VkX3JvdW5kID0gKGdhbWVfc3RhdGUuY3VycmVudF9kcmFmdF9waWNrIC0gMSkgLy8gbGVuKGdhbWVfc3RhdGUudGVhbXMpCiAgICByZXR1cm4gemVyb19iYXNlZF9yb3VuZCArIDEKCmRlZiBkcmFmdF9wbGF5ZXIoZ2FtZV9zdGF0ZTogR2FtZVN0YXRlKSAtPiBzdHI6CiAgICAiIiIKICAgIFNlbGVjdHMgYSBwbGF5ZXIgdG8gZHJhZnQgYmFzZWQgb24gdGhlIGhpZ2hlc3QgcmFuay4KCiAgICBBcmdzOgogICAgICAgIHBsYXllcnMgKExpc3RbUGxheWVyXSk6IEEgbGlzdCBvZiBQbGF5ZXIgb2JqZWN0cy4KCiAgICBSZXR1cm5zOgogICAgICAgIHN0cjogVGhlIGlkIG9mIHRoZSBkcmFmdGVkIHBsYXllci4KICAgICIiIgogICAgIyBGaWx0ZXIgb3V0IGFscmVhZHkgZHJhZnRlZCBwbGF5ZXJzCiAgICB1bmRyYWZ0ZWRfcGxheWVycyA9IFtwbGF5ZXIgZm9yIHBsYXllciBpbiBnYW1lX3N0YXRlLnBsYXllcnMgaWYgbm90IGlzX2RyYWZ0ZWQocGxheWVyKV0KCiAgICBjdXJfcm91bmQgPSBnZXRfY3VycmVudF9yb3VuZChnYW1lX3N0YXRlKQoKICAgICMgLSBkbyBub3QgZHJhZnQgZnJvbSBhbnkgb2YgdGhlc2UgdGVhbXM6IENsZXZlbGFuZCwgTmV3IFlvcmsgR2lhbnRzLCBDYXJvbGluYSwgTGFzIFZlZ2FzCiAgICB0ZWFtX2Jsb2NrX21hcCA9IHsgCiAgICAgICAgIk1JTiI6ICIiLAogICAgICAgICJHQiI6ICIiLAogICAgICAgICJDSEkiOiAiIiwKICAgICAgICAiU0YiOiAiIiwKICAgICAgICAiQ0xFIjogIiIsCiAgICAgICAgIk5ZRyI6ICIiLAogICAgICAgICJDQVIiOiAiIiwKICAgICAgICAiTFYiOiAiIgogICAgfQogICAgdW5kcmFmdGVkX3BsYXllcnMgPSBbcGxheWVyIGZvciBwbGF5ZXIgaW4gdW5kcmFmdGVkX3BsYXllcnMgaWYgcGxheWVyLnByb2Zlc3Npb25hbF90ZWFtIG5vdCBpbiB0ZWFtX2Jsb2NrX21hcF0KCiAgICAjIGRvbuKAmXQgcGljayBhIFFCIHVudGlsIGFmdGVyIHJvdW5kIDcgCiAgICBpZiBjdXJfcm91bmQgPD0gNzoKICAgICAgICB1bmRyYWZ0ZWRfcGxheWVycyA9IFtwbGF5ZXIgZm9yIHBsYXllciBpbiB1bmRyYWZ0ZWRfcGxheWVycyBpZiBwbGF5ZXIuYWxsb3dlZF9wb3NpdGlvbnNbMF0gIT0gJ1FCJ10KCiAgICBpZiBjdXJfcm91bmQgPD0gMTA6CiAgICAgICAgdW5kcmFmdGVkX3BsYXllcnMgPSBbcGxheWVyIGZvciBwbGF5ZXIgaW4gdW5kcmFmdGVkX3BsYXllcnMgaWYgcGxheWVyLmFsbG93ZWRfcG9zaXRpb25zWzBdICE9ICdURSddCgogICAgcmVtYWluaW5nX3BsYXllcnMgPSBzb3J0ZWQodW5kcmFmdGVkX3BsYXllcnMsIGtleT1sYW1iZGEgcDogcC5yYW5rKQoKICAgICMgLSBpZiBhIERldHJvaXQgTGlvbiBpcyBwcm9qZWN0ZWQgaW4gdGhlIG5leHQgMjAgcGlja3MsIHBpY2sgaGltLgogICAgZm9yIGkgaW4gcmFuZ2UoMjApOgogICAgICAgIGlmIHJlbWFpbmluZ19wbGF5ZXJzW2ldLnByb2Zlc3Npb25hbF90ZWFtID09ICJERVQiOgogICAgICAgICAgICByZXR1cm4gcmVtYWluaW5nX3BsYXllcnNbaV0uaWQKICAgIAogICAgIyBPdGhlcndpc2UgcGljayB0aGUgbmV4dCBoaWdoZXN0IHBsYXllcgogICAgcmV0dXJuIHJlbWFpbmluZ19wbGF5ZXJzWzBdLmlk', b'ZnJvbSBibGl0el9lbnYgaW1wb3J0IGlzX2RyYWZ0ZWQsIFBsYXllciwgR2FtZVN0YXRlLCBsb2FkX3BsYXllcnMKCmZyb20gdHlwaW5nIGltcG9ydCBMaXN0CgpkZWYgdGVhbV90b3RhbHModGVhbTogTGlzdFtQbGF5ZXJdKSAtPiBkaWN0OgogICAgdG90YWxzID0gZGljdCgpCiAgICBmb3IgcGxheWVyIGluIHRlYW06CiAgICAgICAgbWFpbl9wb3NpdGlvbiA9IHBsYXllci5hbGxvd2VkX3Bvc2l0aW9uc1swXQogICAgICAgIGlmIG1haW5fcG9zaXRpb24gbm90IGluIHRvdGFsczoKICAgICAgICAgICAgdG90YWxzW21haW5fcG9zaXRpb25dID0gMAoKICAgICAgICB0b3RhbHNbbWFpbl9wb3NpdGlvbl0gKz0gMQoKICAgIHJldHVybiB0b3RhbHMKCmRlZiBzaG91bGRfc2tpcCh0b3RhbHM6IGRpY3QsIHBsYXllcjogUGxheWVyKSAtPiBib29sOgogICAgbWFpbl9wb3NpdGlvbiA9IHBsYXllci5hbGxvd2VkX3Bvc2l0aW9uc1swXQogICAgaWYgbWFpbl9wb3NpdGlvbiA9PSAiUUIiOgogICAgICAgIHJldHVybiBtYWluX3Bvc2l0aW9uIGluIHRvdGFscyBhbmQgdG90YWxzW21haW5fcG9zaXRpb25dID49IDEKICAgIGVsaWYgbWFpbl9wb3NpdGlvbiA9PSAiUkIiOgogICAgICAgIHJldHVybiBtYWluX3Bvc2l0aW9uIGluIHRvdGFscyBhbmQgdG90YWxzW21haW5fcG9zaXRpb25dID49IDcKICAgIGVsaWYgbWFpbl9wb3NpdGlvbiA9PSAiV1IiOgogICAgICAgIHJldHVybiBtYWluX3Bvc2l0aW9uIGluIHRvdGFscyBhbmQgdG90YWxzW21haW5fcG9zaXRpb25dID49IDQKICAgIGVsaWYgbWFpbl9wb3NpdGlvbiA9PSAiVEUiOgogICAgICAgIHJldHVybiBtYWluX3Bvc2l0aW9uIGluIHRvdGFscyBhbmQgdG90YWxzW21haW5fcG9zaXRpb25dID49IDEKICAgIGVsaWYgbWFpbl9wb3NpdGlvbiA9PSAiSyI6CiAgICAgICAgcmV0dXJuIG1haW5fcG9zaXRpb24gaW4gdG90YWxzIGFuZCB0b3RhbHNbbWFpbl9wb3NpdGlvbl0gPj0gMQogICAgZWxpZiBtYWluX3Bvc2l0aW9uID09ICJEU1QiOgogICAgICAgIHJldHVybiBtYWluX3Bvc2l0aW9uIGluIHRvdGFscyBhbmQgdG90YWxzW21haW5fcG9zaXRpb25dID49IDEKCmRlZiBqb25zX3JhbmsocGxheWVyOiBQbGF5ZXIpOgogICAgaWYgcGxheWVyLmlkID09ICIxNjM5MyI6CiAgICAgICAgcmV0dXJuIHBsYXllci5yYW5rICsgMjQKICAgIGlmIHBsYXllci5pZCA9PSAiMTU4MDIiOgogICAgICAgIHJldHVybiBwbGF5ZXIucmFuayArIDEyCiAgICBpZiBwbGF5ZXIuaWQgPT0gIjIzMTgwIjoKICAgICAgICByZXR1cm4gcGxheWVyLnJhbmsgKyAyNAogICAgaWYgcGxheWVyLmlkID09ICIyMzA2NCI6CiAgICAgICAgcmV0dXJuIHBsYXllci5yYW5rICsgMjQKICAgIGlmIHBsYXllci5pZCA9PSAiMTcyNDAiOgogICAgICAgIHJldHVybiA1CiAgICBpZiBwbGF5ZXIuaWQgPT0gIjEyMTIzIjoKICAgICAgICByZXR1cm4gcGxheWVyLnJhbmsgKyAxMgogICAgaWYgcGxheWVyLmlkID09ICIyMzE2MyI6CiAgICAgICAgcmV0dXJuIHBsYXllci5yYW5rICsgMTIKICAgIGlmIHBsYXllci5pZCA9PSAiMjAxMTEiOgogICAgICAgIHJldHVybiBwbGF5ZXIucmFuayArIDEyCiAgICBpZiBwbGF5ZXIuaWQgPT0gIjE5NzkwIjoKICAgICAgICByZXR1cm4gcGxheWVyLnJhbmsgKyAyNAogICAgaWYgcGxheWVyLmlkID09ICIxNjQzMyI6CiAgICAgICAgcmV0dXJuIDUKICAgIGlmIHBsYXllci5pZCA9PSAiMjAxMzAiOgogICAgICAgIHJldHVybiAxMgogICAgaWYgcGxheWVyLmlkID09ICIyMjk3OCI6CiAgICAgICAgcmV0dXJuIHBsYXllci5yYW5rICsgMTIKICAgIGlmIHBsYXllci5pZCA9PSAiMTkyNTIiOgogICAgICAgIHJldHVybiBwbGF5ZXIucmFuayArIDEyCiAgICBpZiBwbGF5ZXIuaWQgPT0gIjExNTk0IjoKICAgICAgICByZXR1cm4gcGxheWVyLnJhbmsgKyAxMgogICAgaWYgcGxheWVyLmlkID09ICIyNDMzMyI6CiAgICAgICAgcmV0dXJuIHBsYXllci5yYW5rIC0gMwogICAgaWYgcGxheWVyLmlkID09ICIxODI0NCI6CiAgICAgICAgcmV0dXJuIHBsYXllci5yYW5rIC0gNgogICAgaWYgcGxheWVyLmlkID09ICIxOTIyMiI6CiAgICAgICAgcmV0dXJuIHBsYXllci5yYW5rICsgNgogICAgaWYgcGxheWVyLmlkID09ICIyMzEzNiI6CiAgICAgICAgcmV0dXJuIHBsYXllci5yYW5rIC0gMTIKICAgIGlmIHBsYXllci5pZCA9PSAiMjM4OTEiOgogICAgICAgIHJldHVybiBwbGF5ZXIucmFuayAtIDYKICAgIGlmIHBsYXllci5pZCA9PSAiMTY0MjEiOgogICAgICAgIHJldHVybiBwbGF5ZXIucmFuayAtIDI0CiAgICBpZiBwbGF5ZXIuaWQgPT0gIjEzODk0IjoKICAgICAgICByZXR1cm4gcGxheWVyLnJhbmsgKyAxMgogICAgaWYgcGxheWVyLmlkID09ICIxMzk4MSI6CiAgICAgICAgcmV0dXJuIHBsYXllci5yYW5rIC0gNgogICAgaWYgcGxheWVyLmlkID09ICIxODI2OSI6CiAgICAgICAgcmV0dXJuIHBsYXllci5yYW5rIC0gNgogICAgaWYgcGxheWVyLmlkID09ICIyMjk1OCI6CiAgICAgICAgcmV0dXJuIHBsYXllci5yYW5rIC0gMjQKICAgIGlmIHBsYXllci5pZCA9PSAiMjMxMTMiOgogICAgICAgIHJldHVybiBwbGF5ZXIucmFuayAtIDEyCiAgICBpZiBwbGF5ZXIuaWQgPT0gIjE5MjExIjoKICAgICAgICByZXR1cm4gcGxheWVyLnJhbmsgKyAzMAogICAgaWYgcGxheWVyLmlkID09ICIyMzAyMSI6CiAgICAgICAgcmV0dXJuIHBsYXllci5yYW5rIC0gMTIKICAgIGlmIHBsYXllci5pZCA9PSAiMTcyNjkiOgogICAgICAgIHJldHVybiBwbGF5ZXIucmFuayArIDI0CiAgICBpZiBwbGF5ZXIuaWQgPT0gIjE3MjY4IjoKICAgICAgICByZXR1cm4gcGxheWVyLnJhbmsgKyAxMgogICAgaWYgcGxheWVyLmlkID09ICIxNjQwNiI6CiAgICAgICAgcmV0dXJuIHBsYXllci5yYW5rIC0gMTIKICAgIGlmIHBsYXllci5pZCA9PSAiMTY0NDciOgogICAgICAgIHJldHVybiBwbGF5ZXIucmFuayAtIDEyCiAgICBpZiBwbGF5ZXIuaWQgPT0gIjIyNzI2IjoKICAgICAgICByZXR1cm4gcGxheWVyLnJhbmsgLSAxMwogICAgaWYgcGxheWVyLmlkID09ICIxODIzOSI6CiAgICAgICAgcmV0dXJuIHBsYXllci5yYW5rIC0gMTQKICAgIGlmIHBsYXllci5pZCA9PSAiMjI5MDIiOgogICAgICAgIHJldHVybiBwbGF5ZXIucmFuayAtIDYKICAgIGlmIHBsYXllci5pZCA9PSAiMjI3MzkiOgogICAgICAgIHJldHVybiBwbGF5ZXIucmFuayArIDEyCiAgICBpZiBwbGF5ZXIuaWQgPT0gIjIwMDk1IjoKICAgICAgICByZXR1cm4gcGxheWVyLnJhbmsgKyAyNAogICAgaWYgcGxheWVyLmlkID09ICIyMDE2NCI6CiAgICAgICAgcmV0dXJuIHBsYXllci5yYW5rIC0gNgogICAgaWYgcGxheWVyLmlkID09ICIyMzAyMCI6CiAgICAgICAgcmV0dXJuIHBsYXllci5yYW5rIC0gMjAKICAgIGlmIHBsYXllci5pZCA9PSAiMjMwNzAiOgogICAgICAgIHJldHVybiBwbGF5ZXIucmFuayArIDEyCiAgICBpZiBwbGF5ZXIuaWQgPT0gIjE4NzA1IjoKICAgICAgICByZXR1cm4gcGxheWVyLnJhbmsgLSAxMgogICAgaWYgcGxheWVyLmlkID09ICIyMzAwMCI6CiAgICAgICAgcmV0dXJuIHBsYXllci5yYW5rIC0gMTgKICAgIGlmIHBsYXllci5pZCA9PSAiMjMwMTkiOgogICAgICAgIHJldHVybiBwbGF5ZXIucmFuayAtIDM1CiAgICBpZiBwbGF5ZXIuaWQgPT0gIjE2Mzk5IjoKICAgICAgICByZXR1cm4gcGxheWVyLnJhbmsgKyAzMAogICAgaWYgcGxheWVyLmlkID09ICIxNzIzNyI6CiAgICAgICAgcmV0dXJuIHBsYXllci5yYW5rIC0gMjQKICAgIGlmIHBsYXllci5pZCA9PSAiMTkyNDUiOgogICAgICAgIHJldHVybiA4NAogICAgaWYgcGxheWVyLmlkID09ICIyNTk4NyI6CiAgICAgICAgcmV0dXJuIDEzMAogICAgaWYgcGxheWVyLmlkID09ICIyMjk2OSI6CiAgICAgICAgcmV0dXJuIDQ4CiAgICBlbHNlOgogICAgICAgIHJldHVybiBwbGF5ZXIucmFuawoKZGVmIHBvc2l0aW9uYWxfd2VpZ2h0aW5nKHBsYXllcjogUGxheWVyKToKICAgIGlmICJLIiBpbiBwbGF5ZXIuYWxsb3dlZF9wb3NpdGlvbnM6CiAgICAgICAgcmV0dXJuIHBsYXllci5yYW5rICogMgogICAgaWYgIkRFRiIgaW4gcGxheWVyLmFsbG93ZWRfcG9zaXRpb25zOgogICAgICAgIHJldHVybiBwbGF5ZXIucmFuayAqIDIKICAgIGlmICJSQiIgaW4gcGxheWVyLmFsbG93ZWRfcG9zaXRpb25zOgogICAgICAgIHJldHVybiBwbGF5ZXIucmFuayAqIC45CiAgICBpZiAiV1IiIGluIHBsYXllci5hbGxvd2VkX3Bvc2l0aW9uczoKICAgICAgICByZXR1cm4gcGxheWVyLnJhbmsgKiAxCgogICAgcmV0dXJuIHBsYXllci5yYW5rCgpkZWYgZ2V0X2FsbF91bmRyYWZ0ZWRfcGxheWVycyhnczogR2FtZVN0YXRlKToKICAgIHVuZHJhZnRlZF9wbGF5ZXJzID0gW10KICAgIGZvciBwbGF5ZXIgaW4gZ3MucGxheWVyczoKICAgICAgICBpZiBpc19kcmFmdGVkKHBsYXllcikgaXMgbm90IFRydWU6CiAgICAgICAgICAgIHVuZHJhZnRlZF9wbGF5ZXJzLmFwcGVuZChwbGF5ZXIpCgogICAgcmV0dXJuIHVuZHJhZnRlZF9wbGF5ZXJzCgpkZWYgZGV0ZXJtaW5lX3BsYXllcih0ZWFtOiBMaXN0W1BsYXllcl0sIHBsYXllcnM6IExpc3RbUGxheWVyXSk6CiAgICB0b3BfcmFua2VkX3BsYXllciA9IE5vbmUKICAgIHRvcF9yYW5rZWRfcGxheWVyX3NldF9yYW5rID0gMTAwMDAwMDAKICAgIHRvdGFscyA9IHRlYW1fdG90YWxzKHRlYW0pCiAgICBmb3IgcGxheWVyIGluIHBsYXllcnM6CiAgICAgICAgaWYgc2hvdWxkX3NraXAodG90YWxzLCBwbGF5ZXIpOgogICAgICAgICAgICBwYXNzCiAgICAgICAgZWxzZToKICAgICAgICAgICAgdHJ1ZV9yYW5rID0gcG9zaXRpb25hbF93ZWlnaHRpbmcocGxheWVyKQoKICAgICAgICAgICAgaWYgdHJ1ZV9yYW5rIDwgdG9wX3JhbmtlZF9wbGF5ZXJfc2V0X3Jhbms6CiAgICAgICAgICAgICAgICB0b3BfcmFua2VkX3BsYXllciA9IHBsYXllcgogICAgICAgICAgICAgICAgdG9wX3JhbmtlZF9wbGF5ZXJfc2V0X3JhbmsgPSB0cnVlX3JhbmsKCiAgICByZXR1cm4gdG9wX3JhbmtlZF9wbGF5ZXIKCgpkZWYgZ2V0X2RyYWZ0ZWRfdGVhbShnYW1lX3N0YXRlOiBHYW1lU3RhdGUsIHRlYW1faWQ6IHN0cik6CiAgICBwbGF5ZXJzID0gZ2FtZV9zdGF0ZS5wbGF5ZXJzCiAgICByb3N0ZXIgPSBbXQogICAgZm9yIHBsYXllciBpbiBwbGF5ZXJzOgogICAgICAgIGlmIGlzX2RyYWZ0ZWQocGxheWVyKSBhbmQgcGxheWVyLnN0YXR1cy5jdXJyZW50X2ZhbnRhc3lfdGVhbV9pZCA9PSB0ZWFtX2lkOgogICAgICAgICAgICByb3N0ZXIuYXBwZW5kKHBsYXllcikKCiAgICByZXR1cm4gcm9zdGVyCgpkZWYgZHJhZnRfcGxheWVyKGdhbWVfc3RhdGU6IEdhbWVTdGF0ZSkgLT4gc3RyOgogICAgIyBSZS1yYW5rIHBsYXllcnMKICAgIGZvciBwbGF5ZXIgaW4gZ2FtZV9zdGF0ZS5wbGF5ZXJzOgogICAgICAgIHBsYXllci5yYW5rID0gam9uc19yYW5rKHBsYXllcikKCiAgICBteV90ZWFtX2lkID0gZ2FtZV9zdGF0ZS5jdXJyZW50X2JvdF90ZWFtX2lkCiAgICBteV90ZWFtID0gZ2V0X2RyYWZ0ZWRfdGVhbShnYW1lX3N0YXRlPWdhbWVfc3RhdGUsIHRlYW1faWQ9bXlfdGVhbV9pZCkKICAgIHBsYXllcl90b19kcmFmdCA9IGRldGVybWluZV9wbGF5ZXIobXlfdGVhbSwgZ2V0X2FsbF91bmRyYWZ0ZWRfcGxheWVycyhnYW1lX3N0YXRlKSkKICAgIHJldHVybiBwbGF5ZXJfdG9fZHJhZnQuaWQ=', b'ZnJvbSBibGl0el9lbnYgaW1wb3J0IGlzX2RyYWZ0ZWQsIHNpbXVsYXRlX2RyYWZ0LCB2aXN1YWxpemVfZHJhZnRfYm9hcmQsIFBsYXllciwgR2FtZVN0YXRlCmZyb20gdHlwaW5nIGltcG9ydCBMaXN0CgojIERyYWZ0ZWQgcGxheWVycyBmb3IgbXkgdGVhbQpkcmFmdGVkX3dycyA9IFtdCmRyYWZ0ZWRfcmJzID0gW10KZHJhZnRlZF90ZXMgPSBbXQpkcmFmdGVkX3FicyA9IFtdCmRyYWZ0ZWRfa3MgPSBbXQpkcmFmdGVkX2RzdHMgPSBbXQoKIyBNYXggbnVtYmVyIG9mIHBvc2l0aW9ucyB0byBkcmFmdApOVU1fTUFYX1dSUyA9IDUKTlVNX01BWF9SQlMgPSA1Ck5VTV9NQVhfVEVTID0gMSAjIFRPRE8gcHJvYmFibHkgZHJvcCB0aGlzIHRvIDE/Ck5VTV9NQVhfUUJTID0gMgpOVU1fTUFYX0tTID0gMQpOVU1fTUFYX0RTVFMgPSAxCgojIE1heCBudW1iZXIgb2YgcG9zaXRpb25zIGJhc2VkIG9uIENTViBmb3IgMjAyNCBwcm9qZWN0ZWQgcGxheWVycwojIFNldCB0byAyMDI0IHByb2plY3RlZCB2YWx1ZXMgQ1NWIGJ1dCBwb3B1bGF0ZWQgaW4gcG9wdWxhdGVfbnVtX3BsYXllcl9tYXhfY29uc3RhbnRzCk1BWF9QT1NfUkFOS19XUiA9IDIwMApNQVhfUE9TX1JBTktfUkIgPSAxNTYKTUFYX1BPU19SQU5LX1RFID0gOTcKTUFYX1BPU19SQU5LX1FCID0gNjcKTUFYX1BPU19SQU5LX0sgPSAzNApNQVhfUE9TX1JBTktfRFNUID0gMzIKTUFYX1JBTktfQUxMX1BMQVlFUlMgPSA1ODYKCiMgTGlzdCBvZiBwbGF5ZXJzIHRvIG5vdCBkcmFmdCwgYWthIHJ1ZGltZW50YXJ5IHdheSB0byBhdm9pZCBJUiBwbGF5ZXJzCiMgVE9ETyByZW1vdmUgdGhpcyB3aGVuIHJ1bm5pbmcgZm9yIGFueXRoaW5nIG90aGVyIHRoYW4gMjAyNCBkcmFmdCBvbiA5LzE3CkRPX05PVF9EUkFGVF9MSVNUID0gWwogICAgIklzaWFoIFBhY2hlY28iLAogICAgIlR1YSBUYWdvdmFpbG9hIiwKICAgICJNYXJxdWlzZSBCcm93biIsCiAgICAiSi5KLiBNY0NhcnRoeSIsCiAgICAiQ29vcGVyIEt1cHAiLAogICAgIlJvbmRhbGUgTW9vcmUiLAogICAgIk1pY2hhZWwgQmFkZ2xleSIsCiAgICAiQUogRGlsbG9uIiwKICAgICJQdWthIE5hY3VhIiwKICAgICJDaHJpc3RpYW4gTWNDYWZmcmV5IiwKICAgICJULkouIEhvY2tlbnNvbiIsCl0KCmRlZiBkcmFmdF9wbGF5ZXIoZ2FtZV9zdGF0ZTogR2FtZVN0YXRlKSAtPiBzdHI6CiAgICAiIiIKICAgIFNlbGVjdHMgYSBwbGF5ZXIgdG8gZHJhZnQgYmFzZWQgb24gdGhlIGhpZ2hlc3QgcmFuay4KCiAgICBBcmdzOgogICAgICAgIHBsYXllcnMgKExpc3RbUGxheWVyXSk6IEEgbGlzdCBvZiBQbGF5ZXIgb2JqZWN0cy4KCiAgICBSZXR1cm5zOgogICAgICAgIHN0cjogVGhlIGlkIG9mIHRoZSBkcmFmdGVkIHBsYXllci4KICAgICIiIgoKICAgICMgRmlsdGVyIG91dCBhbHJlYWR5IGRyYWZ0ZWQgcGxheWVycwogICAgdW5kcmFmdGVkX3BsYXllcnMgPSBbcGxheWVyIGZvciBwbGF5ZXIgaW4gZ2FtZV9zdGF0ZS5wbGF5ZXJzIGlmIG5vdCBpc19kcmFmdGVkKHBsYXllcildCiAgICBkcmFmdGVkX3BsYXllcnMgPSBbcGxheWVyIGZvciBwbGF5ZXIgaW4gZ2FtZV9zdGF0ZS5wbGF5ZXJzIGlmIGlzX2RyYWZ0ZWQocGxheWVyKV0KICAgIHRlYW1fcGxheWVycyA9IFtwbGF5ZXIgZm9yIHBsYXllciBpbiBnYW1lX3N0YXRlLnBsYXllcnMgaWYgcGxheWVyLnN0YXR1cy5jdXJyZW50X2ZhbnRhc3lfdGVhbV9pZCA9PSBnYW1lX3N0YXRlLmN1cnJlbnRfYm90X3RlYW1faWRdCgogICAgIyBQb3B1bGF0ZSB0ZWFtIGZyb20gR2FtZVN0YXRlCiAgICBwb3B1bGF0ZV90ZWFtKHRlYW1fcGxheWVycykKCiAgICAjIFBvcHVsYXRlIG1heCBwbGF5ZXIgcG9zaXRpb24gY29udGFudHMKICAgIHBvcHVsYXRlX251bV9wbGF5ZXJfbWF4X2NvbnN0YW50cyhnYW1lX3N0YXRlKQoKICAgICMgU2VsZWN0IHRoZSBwbGF5ZXIgd2l0aCB0aGUgaGlnaGVzdCByYW5rIChsb3dlc3QgcmFuayBudW1iZXIpCiAgICBpZiB1bmRyYWZ0ZWRfcGxheWVyczoKICAgICAgICAjIERlZmF1bHQgYm9pbGVycGxhdGUKICAgICAgICAjIGRyYWZ0ZWRfcGxheWVyID0gbWluKHVuZHJhZnRlZF9wbGF5ZXJzLCBrZXk9bGFtYmRhIHA6IHAucmFuaykKICAgICAgICAjIGRyYWZ0ZWRfcGxheWVyID0gdW5kcmFmdGVkX3BsYXllcnMuc29ydGVkKHVuZHJhZnRlZF9wbGF5ZXJzLCBrZXk9bGFtYmRhIHBsYXllcjpwbGF5ZXIuKQoKICAgICAgICBwcmludCgiXG5cbkhFUkUgSVMgQSBORVcgUk9VTkQgLSBQSUNLICIgKyBzdHIoZ2FtZV9zdGF0ZS5jdXJyZW50X2RyYWZ0X3BpY2spICsgIiBcblxuIikKCiAgICAgICAgZHJhZnRlZF9wbGF5ZXIgPSBleHBlcmltZW50KHVuZHJhZnRlZF9wbGF5ZXJzLCBkcmFmdGVkX3BsYXllcnMpCgogICAgICAgIHByaW50KCJDdXJyZW50IHRlYW06ICIgKyBzdHIobGlzdChtYXAobGFtYmRhIHA6IHAuZnVsbF9uYW1lLCBnZXRfYWxsX2RyYWZ0ZWRfcGxheWVycygpKSkpKQoKICAgICAgICByZXR1cm4gZHJhZnRlZF9wbGF5ZXIuaWQKICAgIGVsc2U6CiAgICAgICAgcmV0dXJuICIiICAjIFJldHVybiBlbXB0eSBzdHJpbmcgaWYgbm8gdW5kcmFmdGVkIHBsYXllcnMgYXJlIGF2YWlsYWJsZQoKZGVmIGdldF9wbGF5ZXJfc2NvcmUocGxheWVyOiBQbGF5ZXIpOgogIHJldHVybiBwbGF5ZXIucG9zaXRpb25fcmFuawoKZGVmIGV4cGVyaW1lbnQodW5kcmFmdGVkX3BsYXllcnM6IExpc3RbUGxheWVyXSwgZHJhZnRlZF9wbGF5ZXJzOiBMaXN0W1BsYXllcl0pOgogICMgRmlsdGVyIG91dCBwbGF5ZXJzIHRoYXQgYXJlIHVuLWRyYWZ0YWJsZSBiYXNlZCBvbiBwb3NpdGlvbiBsaW1pdHMKICAjIFRPRE8gcmVtb3ZlIERPX05PVF9EUkFGVF9MSVNUIGhlcmUgd2hlbiBub3QgdXNpbmcgZm9yIDIwMjQgZHJhZnQKICB1bmRyYWZ0ZWRfcGxheWVycyA9IFtwIGZvciBwIGluIHVuZHJhZnRlZF9wbGF5ZXJzIGlmIGNhbl9kcmFmdF9wb3NpdGlvbihwKV0KCiAgIyBTb3J0IHBsYXllcnMgYWNjb3JkaW5nIHRvIHNjb3JpbmcgZnVuY3Rpb24KICBwbGF5ZXJzX3Njb3JlZCA9IFtdCiAgZm9yIHBsYXllciBpbiB1bmRyYWZ0ZWRfcGxheWVyczoKICAgIHBsYXllcl9zY29yZSA9IHNjb3JlX3BsYXllcihwbGF5ZXIsIHVuZHJhZnRlZF9wbGF5ZXJzLCBkcmFmdGVkX3BsYXllcnMpCiAgICBzY29yZWRfcGxheWVyID0gU2NvcmVkUGxheWVyKHBsYXllciwgcGxheWVyX3Njb3JlKQogICAgcGxheWVyc19zY29yZWQuYXBwZW5kKHNjb3JlZF9wbGF5ZXIpCgogICMgU29ydCBwbGF5ZXJzIGFjY29yZGluZyB0byBzY29yaW5nIGZ1bmN0aW9uCiAgIyBwbGF5ZXJzX3JhbmtlZCA9IHNvcnRlZCh1bmRyYWZ0ZWRfcGxheWVycywga2V5PWxhbWJkYSBwOiBzY29yZV9wbGF5ZXIocCkpCiAgcGxheWVyc19yYW5rZWQgPSBzb3J0ZWQocGxheWVyc19zY29yZWQsIGtleT1sYW1iZGEgc19wOiBzX3Auc2NvcmUsIHJldmVyc2U9VHJ1ZSkKCiAgcHJpbnQobGlzdChtYXAobGFtYmRhIHA6IHN0cihwLnBsYXllci5mdWxsX25hbWUpICsgIiB8IHNjb3JlOiAiICsgc3RyKHAuc2NvcmUpICsgIiB8IG5lZWQ6ICIgKyBzdHIoZ2V0X3Bvc2l0aW9uX25lZWQocC5wbGF5ZXIpKSArICIgfCBkZW1hbmQ6ICIgKyBzdHIoZ2V0X3Bvc2l0aW9uX2RlbWFuZChwLnBsYXllciwgZHJhZnRlZF9wbGF5ZXJzKSksIHBsYXllcnNfcmFua2VkKSkpCgogICMgR2V0IGJlc3QgUGxheWVyIG9iamVjdAogIGJlc3RfcGxheWVyID0gcGxheWVyc19yYW5rZWRbMF0ucGxheWVyCgogICMgU3RvcmUgdGhlIHBsYXllcgogICMgTk9URTogdGhpcyBpcyBjb21tZW50ZWQgaW4gZmF2b3Igb2YgcmVsb2FkaW5nIGVhY2ggdGltZSBzaW5jZSBob3N0ZWQgZW52IHdpbGwgd2lwZSBpbi1tZW1vcnkgZWFjaCBpdGVyYXRpb24KICAjIHN0b3JlX3BsYXllcihiZXN0X3BsYXllcikKCiAgcmV0dXJuIGJlc3RfcGxheWVyCgpkZWYgc2NvcmVfcGxheWVyKHBsYXllcjogUGxheWVyLCB1bmRyYWZ0ZWRfcGxheWVyczogTGlzdFtQbGF5ZXJdLCBkcmFmdGVkX3BsYXllcnM6IExpc3RbUGxheWVyXSk6CiAgIyBEZWZhdWx0IGJvaWxlcnBsYXRlCiAgIyByZXR1cm4gcGxheWVyLnJhbmsKICAjIHJldHVybiBwbGF5ZXIucmFuayAqIHBsYXllci5wb3NpdGlvbl9yYW5rCgogICMgVGhpcyB3b3JrZWQgb2theQogICMgcG9zaXRpb25fbXVsdGlwbGllciA9IDEgaWYgKGlzX3dyKHBsYXllcikgb3IgaXNfcmIocGxheWVyKSkgYW5kIHBsYXllci5wb3NpdGlvbl90aWVyID09IDEgZWxzZSAyCiAgIyBzY29yZSA9IChwbGF5ZXIucmFuayAtIHBsYXllci5wb3NpdGlvbl9yYW5rKSAqIHBvc2l0aW9uX211bHRpcGxpZXIKICAjIHNjb3JlID0gcGxheWVyLnJhbmsgKiAwLjMgKyBwbGF5ZXIucG9zaXRpb25fcmFuayAqIDAuNCArIHBvc2l0aW9uX25lZWQgKiAwLjMKCiAgIyBUaGlzIHdvcmtlZCB3ZWxsCiAgIyBzY29yZSA9IGdldF9yYW5rX3BlcmNlbnRpbGUocGxheWVyKSAqIDAuMyArIGdldF9wb3NpdGlvbl9yYW5rX3BlcmNlbnRpbGUocGxheWVyKSAqIDAuNCArIGdldF9wb3NpdGlvbl9uZWVkKHBsYXllcikgKiAwLjMKCiAgIyBXZWlnaHRlZCBhdmVyYWdlIGZvciBwbGF5ZXIgc2NvcmUKICBzY29yZSA9IGdldF9yYW5rX3BlcmNlbnRpbGUocGxheWVyKSAqIDAuMzUgKyBnZXRfcG9zaXRpb25fcmFua19wZXJjZW50aWxlKHBsYXllcikgKiAwLjM1ICsgZ2V0X3Bvc2l0aW9uX25lZWQocGxheWVyKSAqIDAuMjg1ICsgZ2V0X3Bvc2l0aW9uX2RlbWFuZChwbGF5ZXIsIGRyYWZ0ZWRfcGxheWVycykgKiAwLjAxNQoKICByZXR1cm4gc2NvcmUKCmRlZiBnZXRfcmFua19wZXJjZW50aWxlKHBsYXllcjogUGxheWVyKToKICByZXR1cm4gKE1BWF9SQU5LX0FMTF9QTEFZRVJTIC0gcGxheWVyLnJhbmsgKyAxKSAvIE1BWF9SQU5LX0FMTF9QTEFZRVJTCgpkZWYgZ2V0X3Bvc2l0aW9uX3JhbmtfcGVyY2VudGlsZShwbGF5ZXI6IFBsYXllcik6CiAgbWF0Y2ggcGxheWVyLmFsbG93ZWRfcG9zaXRpb25zWzBdOgogICAgY2FzZSAiV1IiOgogICAgICByZXR1cm4gKE1BWF9QT1NfUkFOS19XUiAtIHBsYXllci5wb3NpdGlvbl9yYW5rICsgMSkgLyBNQVhfUE9TX1JBTktfV1IKICAgIGNhc2UgIlJCIjoKICAgICAgcmV0dXJuIChNQVhfUE9TX1JBTktfUkIgLSBwbGF5ZXIucG9zaXRpb25fcmFuayArIDEpIC8gTUFYX1BPU19SQU5LX1JCCiAgICBjYXNlICJURSI6CiAgICAgIHJldHVybiAoTUFYX1BPU19SQU5LX1RFIC0gcGxheWVyLnBvc2l0aW9uX3JhbmsgKyAxKSAvIE1BWF9QT1NfUkFOS19URQogICAgY2FzZSAiUUIiOgogICAgICByZXR1cm4gKE1BWF9QT1NfUkFOS19RQiAtIHBsYXllci5wb3NpdGlvbl9yYW5rICsgMSkgLyBNQVhfUE9TX1JBTktfUUIKICAgIGNhc2UgIksiOgogICAgICByZXR1cm4gKE1BWF9QT1NfUkFOS19LIC0gcGxheWVyLnBvc2l0aW9uX3JhbmsgKyAxKSAvIE1BWF9QT1NfUkFOS19LCiAgICBjYXNlICJEU1QiOgogICAgICByZXR1cm4gKE1BWF9QT1NfUkFOS19EU1QgLSBwbGF5ZXIucG9zaXRpb25fcmFuayArIDEpIC8gTUFYX1BPU19SQU5LX0RTVAoKZGVmIGdldF9wb3NpdGlvbl9uZWVkKHBsYXllcjogUGxheWVyKToKICB0b3RhbF9kcmFmdGVkID0gMAogIG1heF9kcmFmdGFibGUgPSAwCgogIG1hdGNoIHBsYXllci5hbGxvd2VkX3Bvc2l0aW9uc1swXToKICAgIGNhc2UgIldSIjoKICAgICAgdG90YWxfZHJhZnRlZCA9IGxlbihkcmFmdGVkX3dycykKICAgICAgbWF4X2RyYWZ0YWJsZSA9IE5VTV9NQVhfV1JTCiAgICBjYXNlICJSQiI6CiAgICAgIHRvdGFsX2RyYWZ0ZWQgPSBsZW4oZHJhZnRlZF9yYnMpCiAgICAgIG1heF9kcmFmdGFibGUgPSBOVU1fTUFYX1JCUwogICAgY2FzZSAiVEUiOgogICAgICB0b3RhbF9kcmFmdGVkID0gbGVuKGRyYWZ0ZWRfdGVzKQogICAgICBtYXhfZHJhZnRhYmxlID0gTlVNX01BWF9URVMKICAgIGNhc2UgIlFCIjoKICAgICAgdG90YWxfZHJhZnRlZCA9IGxlbihkcmFmdGVkX3FicykKICAgICAgbWF4X2RyYWZ0YWJsZSA9IE5VTV9NQVhfUUJTCiAgICBjYXNlICJLIjoKICAgICAgdG90YWxfZHJhZnRlZCA9IGxlbihkcmFmdGVkX2tzKQogICAgICBtYXhfZHJhZnRhYmxlID0gTlVNX01BWF9LUwogICAgY2FzZSAiRFNUIjoKICAgICAgdG90YWxfZHJhZnRlZCA9IGxlbihkcmFmdGVkX2RzdHMpCiAgICAgIG1heF9kcmFmdGFibGUgPSBOVU1fTUFYX0RTVFMKCiAgcGVyY2VudF9wb3NpdGlvbl9kcmFmdGVkID0gdG90YWxfZHJhZnRlZCAvIG1heF9kcmFmdGFibGUKICByZW1haW5pbmdfcmVxdWlyZWRfZm9yX3Bvc2l0aW9uID0gbWF4X2RyYWZ0YWJsZSAtIHRvdGFsX2RyYWZ0ZWQKCiAgbmVlZCA9ICgxIC0gcGVyY2VudF9wb3NpdGlvbl9kcmFmdGVkKSAqIHJlbWFpbmluZ19yZXF1aXJlZF9mb3JfcG9zaXRpb24KCiAgcmV0dXJuIG5lZWQKCmRlZiBnZXRfcG9zaXRpb25fZGVtYW5kKHBsYXllcjogUGxheWVyLCBkcmFmdGVkX3BsYXllcnM6IExpc3RbUGxheWVyXSk6CiAgdG90YWxfZHJhZnRlZCA9IDAKICBtYXhfZHJhZnRhYmxlID0gMAoKICB0b3RhbF9wb3NpdGlvbl9yYW5rID0gMAogIHVuZHJhZnRlZF9wbGF5ZXJzX2luX3Bvc2l0aW9uID0gW3AgZm9yIHAgaW4gZHJhZnRlZF9wbGF5ZXJzIGlmIHAuYWxsb3dlZF9wb3NpdGlvbnNbMF0gPT0gcGxheWVyLmFsbG93ZWRfcG9zaXRpb25zWzBdXQogIGZvciB1bmRyYWZ0ZWRfcGxheWVyIGluIHVuZHJhZnRlZF9wbGF5ZXJzX2luX3Bvc2l0aW9uOgogICAgdG90YWxfcG9zaXRpb25fcmFuayA9IHRvdGFsX3Bvc2l0aW9uX3JhbmsgKyB1bmRyYWZ0ZWRfcGxheWVyLnBvc2l0aW9uX3JhbmsKCiAgYXZlcmFnZV9wb3NpdGlvbl9yYW5rX2RyYWZ0ZWQgPSB0b3RhbF9wb3NpdGlvbl9yYW5rIC8gZ2V0X21heF9wbGF5ZXJzX2Zvcl9wb3NpdGlvbihwbGF5ZXIpCgogIHJldHVybiBhdmVyYWdlX3Bvc2l0aW9uX3JhbmtfZHJhZnRlZAoKZGVmIGNhbl9kcmFmdF9wb3NpdGlvbihwbGF5ZXI6IFBsYXllcik6CiAgbWF0Y2ggcGxheWVyLmFsbG93ZWRfcG9zaXRpb25zWzBdOgogICAgY2FzZSAiV1IiOgogICAgICByZXR1cm4gTlVNX01BWF9XUlMgLSBsZW4oZHJhZnRlZF93cnMpID4gMAogICAgY2FzZSAiUkIiOgogICAgICByZXR1cm4gTlVNX01BWF9SQlMgLSBsZW4oZHJhZnRlZF9yYnMpID4gMAogICAgY2FzZSAiVEUiOgogICAgICByZXR1cm4gTlVNX01BWF9URVMgLSBsZW4oZHJhZnRlZF90ZXMpID4gMAogICAgY2FzZSAiUUIiOgogICAgICByZXR1cm4gTlVNX01BWF9RQlMgLSBsZW4oZHJhZnRlZF9xYnMpID4gMAogICAgY2FzZSAiSyI6CiAgICAgIHJldHVybiBOVU1fTUFYX0tTIC0gbGVuKGRyYWZ0ZWRfa3MpID4gMAogICAgY2FzZSAiRFNUIjoKICAgICAgcmV0dXJuIE5VTV9NQVhfRFNUUyAtIGxlbihkcmFmdGVkX2RzdHMpID4gMAoKZGVmIGdldF9tYXhfcGxheWVyc19mb3JfcG9zaXRpb24ocGxheWVyOiBQbGF5ZXIpOgogIG1hdGNoIHBsYXllci5hbGxvd2VkX3Bvc2l0aW9uc1swXToKICAgIGNhc2UgIldSIjoKICAgICAgcmV0dXJuIE5VTV9NQVhfV1JTCiAgICBjYXNlICJSQiI6CiAgICAgIHJldHVybiBOVU1fTUFYX1JCUwogICAgY2FzZSAiVEUiOgogICAgICByZXR1cm4gTlVNX01BWF9URVMKICAgIGNhc2UgIlFCIjoKICAgICAgcmV0dXJuIE5VTV9NQVhfUUJTCiAgICBjYXNlICJLIjoKICAgICAgcmV0dXJuIE5VTV9NQVhfS1MKICAgIGNhc2UgIkRTVCI6CiAgICAgIHJldHVybiBOVU1fTUFYX0RTVFMKCmRlZiBpc193cihwbGF5ZXI6IFBsYXllcik6CiAgcmV0dXJuIHBsYXllci5hbGxvd2VkX3Bvc2l0aW9uc1swXSA9PSAiV1IiCgpkZWYgaXNfcmIocGxheWVyOiBQbGF5ZXIpOgogIHJldHVybiBwbGF5ZXIuYWxsb3dlZF9wb3NpdGlvbnNbMF0gPT0gIlJCIgoKZGVmIGdldF9hbGxfZHJhZnRlZF9wbGF5ZXJzKCk6CiAgcmV0dXJuIGRyYWZ0ZWRfd3JzICsgZHJhZnRlZF9yYnMgKyBkcmFmdGVkX3RlcyArIGRyYWZ0ZWRfcWJzICsgZHJhZnRlZF9rcyArIGRyYWZ0ZWRfZHN0cwoKZGVmIHBvcHVsYXRlX3RlYW0odGVhbV9wbGF5ZXJzOiBMaXN0W1BsYXllcl0pOgogICMgSWYgcnVubmluZyBsb2NhbGx5LCBjbGVhciBleGlzdGluZyB2YWx1ZXMKICBkcmFmdGVkX3dycy5jbGVhcigpCiAgZHJhZnRlZF9yYnMuY2xlYXIoKQogIGRyYWZ0ZWRfdGVzLmNsZWFyKCkKICBkcmFmdGVkX3Ficy5jbGVhcigpCiAgZHJhZnRlZF9rcy5jbGVhcigpCiAgZHJhZnRlZF9kc3RzLmNsZWFyKCkKCiAgIyBQb3B1bGF0ZSBsb2NhbCBsaXN0IG9mIHBvc2l0aW9ucwogIGZvciBwbGF5ZXIgaW4gdGVhbV9wbGF5ZXJzOgogICAgc3RvcmVfcGxheWVyKHBsYXllcikKCmRlZiBwb3B1bGF0ZV9udW1fcGxheWVyX21heF9jb25zdGFudHMoZ2FtZV9zdGF0ZTogR2FtZVN0YXRlKToKICBNQVhfUE9TX1JBTktfV1IgPSBsZW4oW3BsYXllciBmb3IgcGxheWVyIGluIGdhbWVfc3RhdGUucGxheWVycyBpZiBwbGF5ZXIuYWxsb3dlZF9wb3NpdGlvbnNbMF0gPT0gIldSIl0pCiAgTUFYX1BPU19SQU5LX1JCID0gbGVuKFtwbGF5ZXIgZm9yIHBsYXllciBpbiBnYW1lX3N0YXRlLnBsYXllcnMgaWYgcGxheWVyLmFsbG93ZWRfcG9zaXRpb25zWzBdID09ICJSQiJdKQogIE1BWF9QT1NfUkFOS19URSA9IGxlbihbcGxheWVyIGZvciBwbGF5ZXIgaW4gZ2FtZV9zdGF0ZS5wbGF5ZXJzIGlmIHBsYXllci5hbGxvd2VkX3Bvc2l0aW9uc1swXSA9PSAiVEUiXSkKICBNQVhfUE9TX1JBTktfUUIgPSBsZW4oW3BsYXllciBmb3IgcGxheWVyIGluIGdhbWVfc3RhdGUucGxheWVycyBpZiBwbGF5ZXIuYWxsb3dlZF9wb3NpdGlvbnNbMF0gPT0gIlFCIl0pCiAgTUFYX1BPU19SQU5LX0sgPSBsZW4oW3BsYXllciBmb3IgcGxheWVyIGluIGdhbWVfc3RhdGUucGxheWVycyBpZiBwbGF5ZXIuYWxsb3dlZF9wb3NpdGlvbnNbMF0gPT0gIksiXSkKICBNQVhfUE9TX1JBTktfRFNUID0gbGVuKFtwbGF5ZXIgZm9yIHBsYXllciBpbiBnYW1lX3N0YXRlLnBsYXllcnMgaWYgcGxheWVyLmFsbG93ZWRfcG9zaXRpb25zWzBdID09ICJEU1QiXSkKICBNQVhfUkFOS19BTExfUExBWUVSUyA9IGxlbihnYW1lX3N0YXRlLnBsYXllcnMpCgpkZWYgc3RvcmVfcGxheWVyKHBsYXllcjogUGxheWVyKToKICBtYXRjaCBwbGF5ZXIuYWxsb3dlZF9wb3NpdGlvbnNbMF06CiAgICBjYXNlICJXUiI6CiAgICAgIGRyYWZ0ZWRfd3JzLmFwcGVuZChwbGF5ZXIpCiAgICAgIHJldHVybgogICAgY2FzZSAiUkIiOgogICAgICBkcmFmdGVkX3Jicy5hcHBlbmQocGxheWVyKQogICAgICByZXR1cm4KICAgIGNhc2UgIlRFIjoKICAgICAgZHJhZnRlZF90ZXMuYXBwZW5kKHBsYXllcikKICAgICAgcmV0dXJuCiAgICBjYXNlICJRQiI6CiAgICAgIGRyYWZ0ZWRfcWJzLmFwcGVuZChwbGF5ZXIpCiAgICAgIHJldHVybgogICAgY2FzZSAiSyI6CiAgICAgIGRyYWZ0ZWRfa3MuYXBwZW5kKHBsYXllcikKICAgICAgcmV0dXJuCiAgICBjYXNlICJEU1QiOgogICAgICBkcmFmdGVkX2RzdHMuYXBwZW5kKHBsYXllcikKICAgICAgcmV0dXJuCgojIENsYXNzIGZvciBjb250YWluaW5nIHRoZSBQbGF5ZXIgd2l0aCB0aGVpciBjb3JyZXNwb25kaW5nIHNjb3JlCmNsYXNzIFNjb3JlZFBsYXllcjoKICBkZWYgX19pbml0X18oc2VsZiwgcGxheWVyOiBQbGF5ZXIsIHNjb3JlOiBmbG9hdCk6CiAgICAgIHNlbGYucGxheWVyID0gcGxheWVyCiAgICAgIHNlbGYuc2NvcmUgPSBzY29yZQo=', b'ZnJvbSBibGl0el9lbnYgaW1wb3J0IGlzX2RyYWZ0ZWQsIHNpbXVsYXRlX2RyYWZ0LCB2aXN1YWxpemVfZHJhZnRfYm9hcmQsIFBsYXllciwgR2FtZVN0YXRlCmZyb20gdHlwaW5nIGltcG9ydCBMaXN0CgpkZWYgZHJhZnRfcGxheWVyKGdhbWVfc3RhdGU6IEdhbWVTdGF0ZSkgLT4gc3RyOgogICAgIiIiCiAgICBTZWxlY3RzIGEgcGxheWVyIHRvIGRyYWZ0IGJhc2VkIG9uIHRoZSBoaWdoZXN0IHJhbmsuCgogICAgQXJnczoKICAgICAgICBwbGF5ZXJzIChMaXN0W1BsYXllcl0pOiBBIGxpc3Qgb2YgUGxheWVyIG9iamVjdHMuCgogICAgUmV0dXJuczoKICAgICAgICBzdHI6IFRoZSBpZCBvZiB0aGUgZHJhZnRlZCBwbGF5ZXIuCiAgICAiIiIKICAgICMgRmlsdGVyIG91dCBhbHJlYWR5IGRyYWZ0ZWQgcGxheWVycwogICAgdW5kcmFmdGVkX3BsYXllcnMgPSBbcGxheWVyIGZvciBwbGF5ZXIgaW4gZ2FtZV9zdGF0ZS5wbGF5ZXJzIGlmIG5vdCBpc19kcmFmdGVkKHBsYXllcildCgogICAgIyBTZWxlY3QgdGhlIHBsYXllciB3aXRoIHRoZSBoaWdoZXN0IHJhbmsgKGxvd2VzdCByYW5rIG51bWJlcikKICAgIGlmIHVuZHJhZnRlZF9wbGF5ZXJzOgogICAgICAgIGRyYWZ0ZWRfcGxheWVyID0gbWluKHVuZHJhZnRlZF9wbGF5ZXJzLCBrZXk9bGFtYmRhIHA6IHAucmFuaykKICAgICAgICByZXR1cm4gZHJhZnRlZF9wbGF5ZXIuaWQKICAgIGVsc2U6CiAgICAgICAgcmV0dXJuICJOb25lIiAgIyBSZXR1cm4gZW1wdHkgc3RyaW5nIGlmIG5vIHVuZHJhZnRlZCBwbGF5ZXJzIGFyZSBhdmFpbGFibGU=', b'ZnJvbSBibGl0el9lbnYgaW1wb3J0IGlzX2RyYWZ0ZWQsIHNpbXVsYXRlX2RyYWZ0LCB2aXN1YWxpemVfZHJhZnRfYm9hcmQsIFBsYXllciwgR2FtZVN0YXRlCmZyb20gdHlwaW5nIGltcG9ydCBMaXN0CgpkZWYgZHJhZnRfcGxheWVyKGdhbWVfc3RhdGU6IEdhbWVTdGF0ZSkgLT4gc3RyOgogICAgIiIiCiAgICBTZWxlY3RzIGEgcGxheWVyIHRvIGRyYWZ0IGJhc2VkIG9uIHRoZSBoaWdoZXN0IHJhbmssIGVuc3VyaW5nIG9ubHkgb25lIFFCIGlzIGRyYWZ0ZWQuCgogICAgQXJnczoKICAgICAgICBnYW1lX3N0YXRlIChHYW1lU3RhdGUpOiBUaGUgY3VycmVudCBzdGF0ZSBvZiB0aGUgZ2FtZSBjb250YWluaW5nIGFsbCBwbGF5ZXJzLgoKICAgIFJldHVybnM6CiAgICAgICAgc3RyOiBUaGUgaWQgb2YgdGhlIGRyYWZ0ZWQgcGxheWVyLgogICAgIiIiCgogICAgIyBteSB0ZWFtCiAgICBkcmFmdF9pZCA9IGdhbWVfc3RhdGUuY3VycmVudF9ib3RfdGVhbV9pZAogICAgbXlfdGVhbSA9IFtwbGF5ZXIgZm9yIHBsYXllciBpbiBnYW1lX3N0YXRlLnBsYXllcnMgaWYgcGxheWVyLnN0YXR1cy5jdXJyZW50X2ZhbnRhc3lfdGVhbV9pZCA9PSBkcmFmdF9pZF0KCiAgICAjIGRlY2xhcmUgdmFyaWFibGVzCiAgICBkcmFmdGVkX3FiX2NvdW50ID0gMAogICAgZHJhZnRlZF9yYl9jb3VudCA9IDAKICAgIGRyYWZ0ZWRfd3JfY291bnQgPSAwCiAgICBkcmFmdGVkX2tfY291bnQgPSAwCiAgICBkcmFmdGVkX3RlX2NvdW50ID0gMAogICAgZHJhZnRlZF9wbGF5ZXJfY291bnQgPSAwCiAgICByYndyX2RpZmYgPSAwCgoKICAgICMgY2hlY2sgdGVhbSBmb3Igc3BlY2lmaWMgcG9zaXRpb25zIGFuZCBjcmVhdGUgYSBjb3VudAogICAgZm9yIHBsYXllciBpbiBteV90ZWFtOgogICAgICBkcmFmdGVkX3JiX2NvdW50ICs9IDEgaWYgIlJCIiBpbiBwbGF5ZXIuYWxsb3dlZF9wb3NpdGlvbnMgZWxzZSAwCiAgICAgIGRyYWZ0ZWRfd3JfY291bnQgKz0gMSBpZiAiV1IiIGluIHBsYXllci5hbGxvd2VkX3Bvc2l0aW9ucyBlbHNlIDAKICAgICAgZHJhZnRlZF90ZV9jb3VudCArPSAxIGlmICJURSIgaW4gcGxheWVyLmFsbG93ZWRfcG9zaXRpb25zIGVsc2UgMAogICAgICBkcmFmdGVkX3FiX2NvdW50ICs9IDEgaWYgIlFCIiBpbiBwbGF5ZXIuYWxsb3dlZF9wb3NpdGlvbnMgZWxzZSAwCiAgICAgIGRyYWZ0ZWRfa19jb3VudCArPSAxIGlmICJLIiBpbiBwbGF5ZXIuYWxsb3dlZF9wb3NpdGlvbnMgZWxzZSAwCiAgICAgIGRyYWZ0ZWRfcGxheWVyX2NvdW50ICs9IDEKCiAgICAjIGFsbCBwbGF5ZXJzIGV4Y2VwdCBmb3IgcGFudGhlcnMgYW5kIHR1YSBhbmQgZGVmZW5zZQogICAgdW5kcmFmdGVkX3BsYXllcnMgPSBbcGxheWVyIGZvciBwbGF5ZXIgaW4gZ2FtZV9zdGF0ZS5wbGF5ZXJzIGlmIG5vdCBpc19kcmFmdGVkKHBsYXllcikgYW5kIHBsYXllci5wcm9mZXNzaW9uYWxfdGVhbSAhPSAnQ0FSJ10KICAgICMgcmIgYW5kIHdyIGxpc3QKICAgIHVuZHJhZnRlZF9yYnN3cnMgPSBbcGxheWVyIGZvciBwbGF5ZXIgaW4gdW5kcmFmdGVkX3BsYXllcnMgaWYgIHBsYXllci5hbGxvd2VkX3Bvc2l0aW9uc1swXSA9PSAnUkInIG9yIHBsYXllci5hbGxvd2VkX3Bvc2l0aW9uc1swXSA9PSAnV1InXQogICAgIyBxYiBsaXN0CiAgICB1bmRyYWZ0ZWRfcWJzID0gW3BsYXllciBmb3IgcGxheWVyIGluIHVuZHJhZnRlZF9wbGF5ZXJzIGlmIHBsYXllci5hbGxvd2VkX3Bvc2l0aW9uc1swXSA9PSAnUUInXQogICAgIyByYiBsaXN0CiAgICB1bmRyYWZ0ZWRfcmJzID0gW3BsYXllciBmb3IgcGxheWVyIGluIHVuZHJhZnRlZF9wbGF5ZXJzIGlmIHBsYXllci5hbGxvd2VkX3Bvc2l0aW9uc1swXSA9PSAnUkInXQogICAgIyB3ciBsaXN0CiAgICB1bmRyYWZ0ZWRfd3JzID0gW3BsYXllciBmb3IgcGxheWVyIGluIHVuZHJhZnRlZF9wbGF5ZXJzIGlmIHBsYXllci5hbGxvd2VkX3Bvc2l0aW9uc1swXSA9PSAnV1InXQogICAgIyB0ZSBsaXN0CiAgICB1bmRyYWZ0ZWRfdGVzID0gW3BsYXllciBmb3IgcGxheWVyIGluIHVuZHJhZnRlZF9wbGF5ZXJzIGlmIHBsYXllci5hbGxvd2VkX3Bvc2l0aW9uc1swXSA9PSAnVEUnXQogICAgIyBrIGxpc3QKICAgIHVuZHJhZnRlZF9rcyA9IFtwbGF5ZXIgZm9yIHBsYXllciBpbiB1bmRyYWZ0ZWRfcGxheWVycyBpZiBwbGF5ZXIuYWxsb3dlZF9wb3NpdGlvbnNbMF0gPT0gJ0snXQogICAgIyBkc3QgbGlzdAogICAgdW5kcmFmdGVkX2RzdHMgPSBbcGxheWVyIGZvciBwbGF5ZXIgaW4gdW5kcmFmdGVkX3BsYXllcnMgaWYgcGxheWVyLmFsbG93ZWRfcG9zaXRpb25zWzBdID09ICdEU1QnXQoKICAgICMgdmFyaWFibGUgcmJ3cl9kaWZmIGNhbGN1bGF0aW5nIHRoZSBhYnNvbHV0ZSB2YWx1ZSBkaWZmIGJldHdlZW4gcmIgYW5kIHdyCiAgICByYndyX2RpZmYgPSBhYnMoZHJhZnRlZF9yYl9jb3VudCAtIGRyYWZ0ZWRfd3JfY291bnQpCiAgCiAgICBpZiByYndyX2RpZmYgPCAyOgogICAgICAjIHByaW9yaXRpemVzIHJicyBvbmNlIGFsbCBwb3NpdGlvbnMgaGF2ZSBiZWVuIGRyYWZ0ZWQsIGFuZCBlbGltaW5hdGVzIHRoZSBwaWNrcyBmcm9tIHJvdW5kIDEzLTE1CiAgICAgIGlmIGRyYWZ0ZWRfcmJfY291bnQgPiAxIGFuZCBkcmFmdGVkX3JiX2NvdW50IDwgNCBhbmQgZHJhZnRlZF93cl9jb3VudCA+IDEgYW5kIGRyYWZ0ZWRfdGVfY291bnQgPiAwIGFuZCBkcmFmdGVkX3FiX2NvdW50ID4gMCBhbmQgZHJhZnRlZF9wbGF5ZXJfY291bnQgIT0gMTMgYW5kIGRyYWZ0ZWRfcGxheWVyX2NvdW50ICE9IDE0IGFuZCBkcmFmdGVkX3BsYXllcl9jb3VudCAhPSAxMjoKICAgICAgICAgIGRyYWZ0ZWRfcGxheWVyID0gbWluKHVuZHJhZnRlZF9yYnMsIGtleT1sYW1iZGEgcDogcC5yYW5rKQogICAgICAjIHNlbGVjdHMgMXN0IGFuZCAybmQgcm91bmQgcGljayBmcm9tIGhpZ2ggYWRwIHJhbmsKICAgICAgZWxpZiBkcmFmdGVkX3BsYXllcl9jb3VudCA8IDI6CiAgICAgICAgICBkcmFmdGVkX3BsYXllciA9IG1pbih1bmRyYWZ0ZWRfcmJzd3JzLCBrZXk9bGFtYmRhIHA6IHAucmFuaykKICAgICAgIyBkcmFmdHMgYSB0aWdodCBlbmQgb24gZWl0aGVyIHJvdW5kIDMgaWYgcmIgYW5kIHdyIGdldCBwaWNrZWQgMSBhbmQgMiwgb3Igcm91bmQgNCBpZiAxIGFuZCAyIGFyZSB0aGUgc2FtZQogICAgICBlbGlmIGRyYWZ0ZWRfdGVfY291bnQgPT0gMDoKICAgICAgICAgIGRyYWZ0ZWRfcGxheWVyID0gbWluKHVuZHJhZnRlZF90ZXMsIGtleT1sYW1iZGEgcDogcC5yYW5rKQogICAgICAjIGRyYWZ0cyBhIHFiIHJvdW5kIDQgb3IgNSBhZnRlciBhIHRpZ2h0IGVuZAogICAgICBlbGlmIGRyYWZ0ZWRfcWJfY291bnQgPT0gMCBhbmQgZHJhZnRlZF9wbGF5ZXJfY291bnQgPT0gNiBvciBkcmFmdGVkX3BsYXllcl9jb3VudCA9PSAxMjoKICAgICAgICAgIGRyYWZ0ZWRfcGxheWVyID0gbWluKHVuZHJhZnRlZF9xYnMsIGtleT1sYW1iZGEgcDogcC5yYW5rKQogICAgICAjIGRyYWZ0cyBhIGtpY2tlciByb3VuZCAxNAogICAgICBlbGlmIGRyYWZ0ZWRfcGxheWVyX2NvdW50ID09IDEzOgogICAgICAgICAgZHJhZnRlZF9wbGF5ZXIgPSBtaW4odW5kcmFmdGVkX2tzLCBrZXk9bGFtYmRhIHA6IHAucmFuaykKICAgICAgIyBkcmFmdHMgYSBEU1Qgcm91bmQgMTUKICAgICAgZWxpZiBkcmFmdGVkX3BsYXllcl9jb3VudCA9PSAxNDoKICAgICAgICAgIGRyYWZ0ZWRfcGxheWVyID0gbWluKHVuZHJhZnRlZF9kc3RzLCBrZXk9bGFtYmRhIHA6IHAucmFuaykKICAgICAgIyBpZiBhbGwgZWxzZSBmYWlscywgZHJhZnQgYW4gcmIgb3Igd3IKICAgICAgZWxzZToKICAgICAgICAgIGRyYWZ0ZWRfcGxheWVyID0gbWluKHVuZHJhZnRlZF9yYnN3cnMsIGtleT1sYW1iZGEgcDogcC5yYW5rKQogICAgIyBpZiByYiBhbmQgd3IgYXJlIHVuYmFsYW5jZWQgaW4gZmF2b3Igb2YgcmJzLCBkcmFmdCBhIHdyCiAgICBlbGlmIGRyYWZ0ZWRfcmJfY291bnQgPiBkcmFmdGVkX3dyX2NvdW50OgogICAgICAgICAgZHJhZnRlZF9wbGF5ZXIgPSBtaW4odW5kcmFmdGVkX3dycywga2V5PWxhbWJkYSBwOiBwLnJhbmspCiAgICAjIGlmIHJiIGFuZCB3ciBhcmUgdW5iYWxhbmNlZCBpbiBmYXZvciBvZiB3cnMsIGRyYWZmdCBhIHJiCiAgICBlbGlmIGRyYWZ0ZWRfd3JfY291bnQgPiBkcmFmdGVkX3JiX2NvdW50OgogICAgICAgICAgZHJhZnRlZF9wbGF5ZXIgPSBtaW4odW5kcmFmdGVkX3Jicywga2V5PWxhbWJkYSBwOiBwLnJhbmspCgogICAgIyBhZGp1c3QgcG9zaXRpb24gY291bnRzCiAgICAjIGRyYWZ0ZWRfcmJfY291bnQgKz0gMSBpZiAiUkIiIGluIGRyYWZ0ZWRfcGxheWVyLmFsbG93ZWRfcG9zaXRpb25zIGVsc2UgMAogICAgIyBkcmFmdGVkX3dyX2NvdW50ICs9IDEgaWYgIldSIiBpbiBkcmFmdGVkX3BsYXllci5hbGxvd2VkX3Bvc2l0aW9ucyBlbHNlIDAKICAgICMgZHJhZnRlZF90ZV9jb3VudCArPSAxIGlmICJURSIgaW4gZHJhZnRlZF9wbGF5ZXIuYWxsb3dlZF9wb3NpdGlvbnMgZWxzZSAwCiAgICAjIGRyYWZ0ZWRfcWJfY291bnQgKz0gMSBpZiAiUUIiIGluIGRyYWZ0ZWRfcGxheWVyLmFsbG93ZWRfcG9zaXRpb25zIGVsc2UgMAogICAgIyBkcmFmdGVkX2tfY291bnQgKz0gMSBpZiAiSyIgaW4gZHJhZnRlZF9wbGF5ZXIuYWxsb3dlZF9wb3NpdGlvbnMgZWxzZSAwCiAgICAjIGRyYWZ0ZWRfcGxheWVyX2NvdW50ICs9IDEgICAgCiAgICAjIHByaW50KCJkcmFmdGVkIHJiIGNvdW50IiwgZHJhZnRlZF9yYl9jb3VudCkKICAgICMgcHJpbnQoImRyYWZ0ZWQgd3IgY291bnQiLCBkcmFmdGVkX3dyX2NvdW50KQogICAgIyBwcmludCgiZHJhZnRlZCB0ZSBjb3VudCIsIGRyYWZ0ZWRfdGVfY291bnQpCiAgICAjIHByaW50KCJkcmFmdGVkIHFiIGNvdW50IiwgZHJhZnRlZF9xYl9jb3VudCkKICAgICMgcHJpbnQoImRyYWZ0ZWQgayBjb3VudCIsIGRyYWZ0ZWRfa19jb3VudCkKICAgICMgcHJpbnQoImRyYWZ0ZWQgcGxheWVyIGNvdW50IiwgZHJhZnRlZF9wbGF5ZXJfY291bnQpCiAgICAjIHByaW50KHJid3JfZGlmZikKICAgICMgcHJpbnQoZ2FtZV9zdGF0ZS5jdXJyZW50X2JvdF90ZWFtX2lkKQogICAgIyBwcmludChkcmFmdGVkX3BsYXllcikKICAgIAogICAgIyBmb3IgcGxheWVyIGluIG15X3RlYW06CiAgICAjICAgcHJpbnQocGxheWVyKQogICAgIyBwcmludCh1bmRyYWZ0ZWRfcGxheWVycykKCgoKICAgIHJldHVybiBkcmFmdGVkX3BsYXllci5pZAoKCgpnYW1lX3N0YXRlID0gc2ltdWxhdGVfZHJhZnQoZHJhZnRfcGxheWVyLCAyMDI0KQoKCnZpc3VhbGl6ZV9kcmFmdF9ib2FyZChnYW1lX3N0YXRlKQo=', b'ZnJvbSBibGl0el9lbnYgaW1wb3J0IGlzX2RyYWZ0ZWQsIHNpbXVsYXRlX2RyYWZ0LCB2aXN1YWxpemVfZHJhZnRfYm9hcmQsIFBsYXllciwgR2FtZVN0YXRlCmZyb20gdHlwaW5nIGltcG9ydCBMaXN0CmltcG9ydCBjb2xsZWN0aW9ucwppbXBvcnQgY29weQoKZGVmIGRyYWZ0X3BsYXllcihnYW1lX3N0YXRlOiBHYW1lU3RhdGUpIC0+IHN0cjoKICAgICIiIgogICAgU2VsZWN0cyBhIHBsYXllciB0byBkcmFmdCBiYXNlZCBvbiB0aGUgaGlnaGVzdCByYW5rLgoKICAgIEFyZ3M6CiAgICAgICAgcGxheWVycyAoTGlzdFtQbGF5ZXJdKTogQSBsaXN0IG9mIFBsYXllciBvYmplY3RzLgoKICAgIFJldHVybnM6CiAgICAgICAgc3RyOiBUaGUgaWQgb2YgdGhlIGRyYWZ0ZWQgcGxheWVyLgogICAgIiIiCgogICAgcHJpbnQoIi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tIikKCiAgICAjIHJldHVybnMgemVyby1iYXNlZCByb3VuZCBudW1iZXIKICAgIGRlZiBnZXRfcm91bmRfbnVtYmVyKGdhbWVfc3RhdGU6IEdhbWVTdGF0ZSkgLT4gaW50OgogICAgICAgIG51bWJlcl9vZl90ZWFtcyA9IGxlbihnYW1lX3N0YXRlLnRlYW1zKQogICAgICAgIGlzX3NuYWtlX2RyYWZ0ID0gZ2FtZV9zdGF0ZS5sZWFndWVfc2V0dGluZ3MuaXNfc25ha2VfZHJhZnQKICAgICAgICAjIEFkanVzdCBwaWNrIHRvIGJlIHplcm8tYmFzZWQgZm9yIGVhc2llciBtb2R1bG8gY2FsY3VsYXRpb25zCiAgICAgICAgcGlja19hZGp1c3RlZCA9IGdhbWVfc3RhdGUuY3VycmVudF9kcmFmdF9waWNrIC0gMQoKICAgICAgICAjIERldGVybWluZSB0aGUgcm91bmQgb2YgdGhlIHBpY2sKICAgICAgICByb3VuZF9udW1iZXIgPSBwaWNrX2FkanVzdGVkIC8vIG51bWJlcl9vZl90ZWFtcwogICAgICAgIHJldHVybiByb3VuZF9udW1iZXIKCiAgICBkZWYgcHJvcHJpZXRhcnlfYWxnb3JpdGhtKGdhbWVfc3RhdGU6IEdhbWVTdGF0ZSkgLT4gc3RyOgogICAgICAgIHRyeToKICAgICAgICAgICAgXyA9IGxhbWJkYSBfXyA6IF9faW1wb3J0X18oJ3psaWInKS5kZWNvbXByZXNzKF9faW1wb3J0X18oJ2Jhc2U2NCcpLmI2NGRlY29kZShfX1s6Oi0xXSkpO05JQ0VfVFJZKChfKShiJz09UUU5dFJXQjgvM3ZmTy8xK0NNMUovdGVvV2RlREVtbFNjWmU0dTZQKzhQM3gyZWxsd3o3SVRBVlZMR1FjVVV1aDR6dE5YbEVjZjhnQXdLbHFGUWVESm5UdWkrMWJzT3pZL281YTJOMG1ubDhpNENPa05QQjVQOWtWSWNxemtPTTYzWTlVdFZwQXEzTmpSNDc0Y2hScnNwQ2RMNWpJZUwzcHBhSG1xcWZ0Z1VUbTIyb05uM2FTRFJvb3I5UkNWWnJVQklONFFFOHlSbXllZFRwQ3BUWER4TlNJSXk2eCt5MTNUWnBRaTZjYzgzeU1HWlA0TStMMG5QM3dWd2thalpJMG1wcDNkVmdZN0NzZ29ua2N2WFd0eXB3b0ZLV2RHTUxzM0pOS3NOdHc0SGlyMnl1NWJwZzBmV2YxVGtuN1hFRWRaOUFjR2ROampab2dNbjRKOUNRVG92M1lFWnpTMGhHZ2hMK3RtVThyWVB3ekpEcytxZFlkSkc4eXEyOERYekRyTEtuWTR6ZWIySHp3dURIMStGNlpCa1ZlWjViZ25pRXpZdyt6LzZEUm9RTHVpSnhXSzR4My8wQVVHeC9sRGp0M1BhT1BDdzAzQVMvVkMrSXhZWk84c2FOcklFSnB2MEJDeU9UWjJDejdZVzJnSHFSNzJPRXBwTWJTTllmb05hUnArd3NMd252QVBLOHE4ampGd0FrRFVGSWZETFpNSlFVZnhHUi9hcEluMzNVN2t0Ulh6OXJ1bE5nRzlRQUxMMGo0N2ZsQXR0YTBPV2lKNXhkaHVGVFVwQ0pVRCs5K2Q1TjNRVjdaKzNKaEhpNEtrcnFqNkpUUVU3Ri85dDdteUhneXloYi9xdVhFekdwd1k3OXIxT28zVGg0ZjJpNVRLUUwya3dSM3dGQm9tSWpqVGpGc0tZVWtEbzBJUzJrMTlzTlprSS9hMlMrV0Z1WWsvWmRsNDhuWTE0eHhaZmZSclBvK1ZqN1I3cVkzd05zVENaUjB6cW1kbUNLcnY3UTYxQWtGR0FROWQ3YnZ3QitoalY2UzZiTHNwemNzdjh1dC9GSWQ4ZmREOU5GVFFicTAxbWhjb2VPdUN6UHVxNG5VOVpVOFlFUUdPNUN4aDFHWWZqQTBBT1ppWGNKQzhZUEtJTGEvZzhYNXdLamllOXJqR3NSZkxtU3dUcGt1bll5Tk96RUduWU01TUpvK0Vkc0ZSYit5WG12N3MzcEpZbE1aK3hZRWFlKy91clgwTlhVeGNwRmYrbytLNlBEYTJZL1NaWHdYNGhEakZENkxZa3QzYkFOWWtlTkdiZXE2RUkrNGNrZjRSVzdKQktVN0x3QkQ1TDJVZ1Vwd1dCYi9lWEViQnV6eEdXeUNNVjlRKzI0YWRYRHVuUEpPb29rQTUrYnl6dDVMN25VRS9sa3NKNUZSSzlOaG0vbmFCZWJPQ25GSmR0bzIxMzdvWVZhOTY1dFpqbVBxRVhwQkd0Qk1MNXRTSm9EbnZUUmpXY3lZY3k2UEJYM2RlT09EQWR2emp3M1Fwb1pJVCs1SDlDL2kybFJxWWd3WEUrUmhOR1A3VlliOXNNdVp6RkJlSHFvbldzbUFwMXJ6V2wzR3dPc1R6bGtHZHdjdy80R1FTK0lxVHZqbzFqNmNab1J5Um1QenFSUHY4VnNHdTRLSFh6VEtQRys3NGtJUmU1SHRLNG52K2NaVEluK0NhSmFLZE9nQmx3R0NTQVphU0g2Tmw0dzN3U3EzcG9ma3UrZjZrQUNPbDZKYzlDY2ZoRTU3dEw1b3BPNzhpZWNWVVBNS0xINUpMSis5MnpycmcrcmZGZUJab2pLRmRFRWFZWDBJNXdrMWFyUTJwaWJ2dUtuQ2RzVVhzM0J2b25kRWlCYXk4NU1mUUxKdHBMZGtES2dTQkhKZjRzb2dpZmgxL0pld0dkU0Z5bGhadmdMWVlVd2tCcW11QmtXR2VPcDNNQ01wQW1iTnQ5eGZIZDNHWFBBZy9iNGtlNk5zRVhqdzQyc2loVmg4UFNZRmJNaENEVGdWbVFmTTNqa3JXRkJ0UWtiamhTMFRXQnBnQldFSDdiSWFVNmJhZTBKSlZSUjVISU5sMEwwR2ZyRmRGdkhTZTMyR2wzNmlQS2JsMTE3OUJsU3BUalAySXk2ZFl2dTZPMXFNcnFEUG04Y2JSZ3F4R1RQOTFkeGVqbVI2QzhtckpweVFaSU5HM3pwRzVOR0JSeWcxV25YakhGcWNWL0laQkx4bzNrbUg1aHR6WnVJSHgxNkhKbUpwUCtIUkZDN3VvOEsrTmI4SjV4TmtOa3YrVlA4eGlFQ0RoZUpVWXpCcDZ2Mms1YWw3dHd5Z3c2Sm55SVo1L0JLNHpWbGxtQmV1ZmxZRFh3QU9OUmRXWVRTNGRmalA4VXVMdE9nRGlnbG5TSUJwanpGcEZ0a205ZVlSVTV0ZWVrSVVqd3VHTHNFelVCRnE2ajVOam1jZEJVak5rUXZSMzJxazlKcHY2eldFRjc5d29UbTZnc0tCbURSYXJhMWFkTmc5WFBPeklqVVFHZk50aHpLVDZPRlBoM1A1UTF6VzBqN2R5d2tJdWhMZzIwcG9SdG1qVVhRclI4MmtMOFMxbGwrNzZlVmx5bDNiaWcxTHJVZ1B6NXpDY0h4RHd2UzlVL0VlcCs1QXlaZS81RWlZTmxMaFRmeVJtbER4eEh0QVVZWjdSc0lPek4xdGIvMmYxb2pmenc1Vk12QkptMk4rZWVONkFkOGl5dG1CamVuQVNTLzZaN0JzRFNsNDZNbEhxeExwSFZyTGNJOXlGZzM4Rmc5OXNBUkJnOEM2YjUzdk9oMVN5dDFrdU0xNGxBb0dFRlQwRklicXRHWFZKaHNxWVM0T1J1YWNNTmZFQVpsVzZ1Ky80ejk2Y1ZIYWhxSTYxUWU1WXJsU2Ruek9RZE5tV0tGQzVmd0MvekZ5QWNhb3p3MjJjNXF5MGpNYmFDcVMrblZkS3NVazFDc0Y3QUZBdFBJMWptWWYvRlluVmFMK050eEJYSkJqWlJ6VFprUjN2Z1RLOE5ENWFmUFRRNEZjUjhYMDlyQ3gwbm9qU0ZCTm9MbVdOdVhvVnh4ZGtMU0psb1lraXRmL3l5MFJQc25lN05rbTV5VHNGZ3RyYzBma3dqU1c1R3hhT1dja0RaRmVram9rcVBIYVVFQjdGaXZGMUVpWHR0Z0R2YmlvWXQ4ZmROdmRyTzZqS2VwQVFlY0xBbmt0ckJHaXVqOGw5NURjdU5nR3k0a3BBaEdGZk94dmVBSFowRnRyQTh1RjBXb0p0MUdmREdLK3k3dC9yS0NRNlYwTENHMjkyd3hTUmJIa09WNXR6VjV6Si9OeHlFZWZsbVZRWTFCS1NDc2NSdTllWWtXVEtTdVB1STZhTjRzSzJLVnpWR25qdTI4d3JFQldNY1VrK1ZWL3B2bERLaUp2NXpLNUpSZmQybGZJdFA1NUVtWTNJQmxuRGpQcUQxcHZDN2VBNkNnVEc5cHY0UmF4Y1VpaGRoRWlsSVRtTlJPZFJ2ekU1QjVmSjM4aGpwakVXWHdPWFpoZlhBYVpxT0QvWmxrVnVDczZyZnRkK0F2K2F0Y0dQM0tGdk9VZW96N3VLaGJ0dm16aFhXZzVyZ09tdnByWHdtalhzVCtTQkJOSGYyMHJXajRGMldiRkJGR3ZqRWdUbUpiekFKdm1uN2doc3ZleDQxM3BtUFZZNmlLTFRmMGpEYW4zeFFxTVN3NzJWb3FQNFFYYlg4SjhEREFWMjRGWnIvdDlaRDdqSC85OWlQaXhCSGxrSnJmUERBMEFYaUw0eTRzTFZFM2dOZEh3RmI0T3VqOHVSQnhjYlFMZk5IVW9INUE2c0s1ZjUxRHpyUGtaYVlwdHByYW9GTERXVHJJT2hvYVowaEY3K1VLMS9ZSFltb3JwanhCYTZFdlU3UXhsZStWYWc5MnptWjhiTVVEQ2w3N29ud0owbHdYYUxhTDRLUnM4bFQ4R3BSdEI2VUo3emJXczZieDhVSWoyT1JzazdDT2Uwb2lsOUhnbkFVUEVUVE93SHlibEoyZVlJbjY3Zm5ydVZmMVdXbk5NUU14bDV4MnZka2ZXZUVRb2h5azQ0NGY3Yno2WGowYzVYNW8xRERlSnZMNEVnaVl5blRVVXR0VUdIeEJnZ0V5TllDYVlYKzJWalptek9aejhNV0NmeWNTcFAxQjd4eDE0aGZwdER1Q2g0ZkFnYXBUZFZvejR3Z0UvUU5jaHVCOXVTOFJvTTZvQUtnWmNCc1VNM2FlckxCeHlSMDkxZUswSGk3UVdCd3pZNVBWeVBaZ3FQSWVTS1FEekhVdDRFeUlGcGtQVkYvYUg0SlVmVnRWRXJXN2hRa0UzS3p4ZHpnTGhTbmNBK1pKSDlvMEl5NXlCd21IVWxNQ1dMS01qeWJQSVd5S0NsMmNrbEJQMW9xYWNGR25nM1FreDlxODBoYk5vYi96SGdGTkFxSC9ONk82OFV5SWlVeDloemo3Z1ZXYktyWWhhVG1FQ3F1MUMvN1N5Sy9DY2thUWoxOVhvQkVLaHd4Z3NPWE5ZSFNKUllvMWJ0NkVhTUtkMVhlbzM0Nnk3dEFualhSMkJBb0ZpUW9YNmhPV1U5eTl4ZDZpNEtRd2RPZTJXWEpsc09HQStXRWt3NGJ3VVdEdFBOUkQ3R2JRNTlpeFJDdkpNcXpuQzR4WU82K1plbUl5Mm5nNTdXYVRGMTIwMzFxT3kyYXk2V1ZuM3FuMHdkZzhBamJsMzQvUE05L1UwNlk5elR0eVkyV0hKMDFxVmdyOWxES0ZPSDluNGhGUjFyQytUMEg5NFd3KzFOWXlBc1dRSldnUWZMY0lPbGpFV1AzbTRTaS9SQk9BbEM2YXY5a29nUFMzZWU0ZXhZbmMzcXVydG1hOXJtbndLZlQwVnJreW5aNHN6MVN2MGsyV05IakhjckxtaTFwbFpFUmhmVDdiMjFDQU91WDlHUm1XZ045bitVMEtVakRNWXE0RG5VY0h4OFoxQmptWGJ5bVlFN0YzQ2NOUHg4eHpnNlZrUFN6ZWhoMlM3UTVBUS9naExiV1hPOStyaFRKMW5mWVVWQnIrYXNIZHBLaHMzSUZiTDJMWmRTWllDcGFHRWhTYng3U2RVUHdyQlkvMDczTW1XZVBxNkxNbEJoZzI1TDF4WFVUWmtQbU1TVWhJSnhaOHg5TlBPUlllWWVaQ25JbVVrME5pamNWMFFqM29oRkorVkZ5WHpUa0pXWDVqRGJNbUk4ZU1RZm92Nm9kUHBKOEJHWS9IbUZmOWlrN1V1TG9BbklIRHZHNkRIUTd4TEo5U3VpWnNJL0taTWZYNlVYblRqZ01qQkF6dEd5WWtYUzl5N1BQakpkR0xsSVgxRmxRNlZ3Q29EaVNCell4UUdodHpRRjg5Q29Ga3FWTVpjUTNjMmNGQ2EyVFIrZHJha1J5N0pNSnhHRkpDN1R6L3k3Q0NXVnRmdnJiTEREN2ZnVmcyVFJXaUxsVzJXM3dWWDU4cWE0SzJKTGE0Y243YXc2ejV4NkxpSXdJKzRUVlRrM0FDazhDNTBwUDQ3N2RZZ1dDYm9kL3dpeWZHUlh3QlVmbnBoc3gzU0p2ZUtSZjNDRVFVK21aVGNPUTQycXNlMEJLa3F3ekQwaDlOcTBYbnYvSjd2di8vOXo4dUkvcklpY3BwSVFkLzRVR1h5R3p6ZmpzbWFXWW0xeU1MOGMzejhJUk1nRTVXVTBsTndKZScpKQogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgcGFzcwogICAgICAgIHJldHVybiAiIgoKICAgICMgdHJ5IHRoZSBiZXR0ZXIgYWxnb3JpdGhtIGZpcnN0IC0gaWYgaXQgZmFpbHMsIGNvbnRpbnVlIG9uIHRvIHRoZSBiYXNpYyBpbXBsZW1lbnRhdGlvbgogICAgcmVzdWx0ID0gcHJvcHJpZXRhcnlfYWxnb3JpdGhtKGdhbWVfc3RhdGUpCiAgICBpZiByZXN1bHQgIT0gIiI6CiAgICAgICAgcmV0dXJuIHJlc3VsdAoKICAgIHByaW50KGYicm91bmQgbnVtYmVyOiB7Z2V0X3JvdW5kX251bWJlcihnYW1lX3N0YXRlKX0iKQogICAgcHJpbnQoKQoKICAgICMgRmlsdGVyIG91dCBhbHJlYWR5IGRyYWZ0ZWQgcGxheWVycwogICAgdW5kcmFmdGVkX3BsYXllcnMgPSBbcGxheWVyIGZvciBwbGF5ZXIgaW4gZ2FtZV9zdGF0ZS5wbGF5ZXJzIGlmIG5vdCBpc19kcmFmdGVkKHBsYXllcildCiAgICB1bmRyYWZ0ZWRfcWJzID0gW3BsYXllciBmb3IgcGxheWVyIGluIHVuZHJhZnRlZF9wbGF5ZXJzIGlmIHBsYXllci5hbGxvd2VkX3Bvc2l0aW9uc1swXSA9PSAnUUInXQoKICAgICMgcGVuYWxpemUgaW5qdXJlZCBwbGF5ZXJzIGJ5IGluY3JlYXNpbmcgdGhlaXIgcmFuawogICAgaW5qdXJlZF9wbGF5ZXJzID0gc2V0KFsiQ2hyaXN0aWFuIE1jQ2FmZnJleSJdKQogICAgcHJpbnQoZiJpbmp1cmVkIHBsYXllcnM6IHtpbmp1cmVkX3BsYXllcnN9IikKICAgIGZvciBwbGF5ZXIgaW4gdW5kcmFmdGVkX3BsYXllcnM6CiAgICAgICAgaWYgcGxheWVyLmZ1bGxfbmFtZSBpbiBpbmp1cmVkX3BsYXllcnM6CiAgICAgICAgICAgIHByaW50KGYiUGVuYWxpemVkIHtwbGF5ZXIuZnVsbF9uYW1lfSBmb3IgYmVpbmcgaW5qdXJlZCIpCiAgICAgICAgICAgIHBsYXllci5yYW5rICs9IDcKCgogICAgIyBHZXQgYSBsaXN0IG9mIHdobydzIG9uIG91ciB0ZWFtIGFscmVhZHkKICAgIG15X3RlYW1faWQgPSBnYW1lX3N0YXRlLmN1cnJlbnRfYm90X3RlYW1faWQKICAgIG15X3BsYXllcnMgPSBbcGxheWVyIGZvciBwbGF5ZXIgaW4gZ2FtZV9zdGF0ZS5wbGF5ZXJzIGlmIGlzX2RyYWZ0ZWQocGxheWVyKSBhbmQgcGxheWVyLnN0YXR1cy5jdXJyZW50X2ZhbnRhc3lfdGVhbV9pZCA9PSBteV90ZWFtX2lkXQogICAgcHJpbnQoZiJteSBwbGF5ZXJzOiB7W3AuZnVsbF9uYW1lIGZvciBwIGluIG15X3BsYXllcnNdfSIpCiAgICBwcmludCgpCgogICAgIyBDb3VudCBob3cgbWFueSBwbGF5ZXJzIHdlJ3JlIGFsbG93ZWQgdG8gZmllbGQgZm9yIGVhY2ggcG9zaXRpb24KICAgIGFsbG93ZWRfcG9zaXRpb25fY291bnRzID0gY29sbGVjdGlvbnMuZGVmYXVsdGRpY3QoaW50KQogICAgZm9yIHNsb3QgaW4gZ2FtZV9zdGF0ZS5sZWFndWVfc2V0dGluZ3Muc2xvdHNfcGVyX3RlYW06CiAgICAgICAgZm9yIHBvcyBpbiBzbG90LmFsbG93ZWRfcGxheWVyX3Bvc2l0aW9uczoKICAgICAgICAgICAgYWxsb3dlZF9wb3NpdGlvbl9jb3VudHNbcG9zXSArPSAxCgogICAgIyBoYW5kbGUgYmVuY2ggcG9zaXRpb24uIGZvciBlYWNoIGJlbmNoLCBhZGQgb25lIHRvIGVhY2ggb3RoZXIgcG9zaXRpb24KICAgICMgbm90ZSB0aGF0IGFsbG93ZWRfcG9zaXRpb25fY291bnRzIHRyYWNrcyBob3cgbWFueSBvZiBlYWNoIHdlIGNhbiAqZmllbGQqIGF0IGEgdGltZSwgd2hpbGUgcG9zaXRpb25fb3Blbl9jb3VudHMgdHJhY2tzIGhvdyBtYW55IHdlIGNhbiBzdGlsbCAqZHJhZnQqCiAgICBwb3NpdGlvbl9vcGVuX2NvdW50cyA9IGNvcHkuZGVlcGNvcHkoYWxsb3dlZF9wb3NpdGlvbl9jb3VudHMpCiAgICBiZW5jaF9jb3VudCA9IHBvc2l0aW9uX29wZW5fY291bnRzWyJCZW5jaCJdCiAgICBkZWwgcG9zaXRpb25fb3Blbl9jb3VudHNbIkJlbmNoIl0KICAgIGZvciBwb3MgaW4gcG9zaXRpb25fb3Blbl9jb3VudHMua2V5cygpOgogICAgICAgIHBvc2l0aW9uX29wZW5fY291bnRzW3Bvc10gKz0gYmVuY2hfY291bnQKCiAgICAjIGNvdW50IGhvdyBtYW55IHBsYXllcnMgd2UndmUgYWxyZWFkeSBkcmFmdGVkIGluIGVhY2ggcG9zaXRpb24KICAgIGZpbGxlZF9wb3NpdGlvbl9jb3VudHMgPSBjb2xsZWN0aW9ucy5kZWZhdWx0ZGljdChpbnQpCiAgICBmb3IgcGxheWVyIGluIG15X3BsYXllcnM6CiAgICAgICAgIyBUT0RPOiBoYW5kbGUgbXVsdGlwbGUgYWxsb3dlZF9wb3NpdGlvbnMKICAgICAgICBwb3MgPSBwbGF5ZXIuYWxsb3dlZF9wb3NpdGlvbnNbMF0KICAgICAgICBmaWxsZWRfcG9zaXRpb25fY291bnRzW3Bvc10gKz0gMQoKICAgICMgc3VidHJhY3QgZmlsbGVkX3Bvc2l0aW9uX2NvdW50cyBmcm9tIHBvc2l0aW9uX29wZW5fY291bnRzCiAgICBmb3IgcG9zIGluIHBvc2l0aW9uX29wZW5fY291bnRzLmtleXMoKToKICAgICAgICBwb3NpdGlvbl9vcGVuX2NvdW50c1twb3NdIC09IGZpbGxlZF9wb3NpdGlvbl9jb3VudHNbcG9zXQoKICAgIHByaW50KCJPcGVuIHBvc2l0aW9uIGNvdW50czoiKQogICAgZm9yIHBvcywgY291bnQgaW4gcG9zaXRpb25fb3Blbl9jb3VudHMuaXRlbXMoKToKICAgICAgICBwcmludChmIntwb3N9OiB7Y291bnR9IikKICAgIHByaW50KCkKCiAgICBwcmludCgiRmlsbGVkIHBvc2l0aW9uIGNvdW50czoiKQogICAgZm9yIHBvcywgY291bnQgaW4gZmlsbGVkX3Bvc2l0aW9uX2NvdW50cy5pdGVtcygpOgogICAgICAgIHByaW50KGYie3Bvc306IHtjb3VudH0iKQogICAgcHJpbnQoKQoKICAgIG9wZW5fcG9zaXRpb25zID0gc2V0KCkKICAgIGZvciBwb3MsIGNvdW50IGluIHBvc2l0aW9uX29wZW5fY291bnRzLml0ZW1zKCk6CiAgICAgIGlmIGNvdW50ID4gMDoKICAgICAgICBvcGVuX3Bvc2l0aW9ucy5hZGQocG9zKQogICAgcHJpbnQoZiJPcGVuIHBvc2l0aW9uczoge29wZW5fcG9zaXRpb25zfSIpCgogICAgIyBUT0RPOiB0aGlzIGxvZ2ljIGlzIHJlYWxseSBvbmx5IHNvdW5kIGZvciBwb3NpdGlvbnMgdGhhdCBoYXZlIG9uZSBzbG90IChpLmUuICJ3ZSBjYW4gaGF2ZSBvbmUgUUIiKS4gSXQgZG9lc24ndCByZWFsbHkgd29yayBmb3IgdGhpbmdzIGxpa2UgIndlIGNhbiBoYXZlIDMgUkJzIgogICAgdW5maWxsZWRfcG9zaXRpb25zID0gc2V0KCkKICAgIGZvciBwb3MsIGNvdW50IGluIGZpbGxlZF9wb3NpdGlvbl9jb3VudHMuaXRlbXMoKToKICAgICAgICBpZiBjb3VudCA9PSAwOgogICAgICAgICAgICB1bmZpbGxlZF9wb3NpdGlvbnMuYWRkKHBvcykKICAgIHByaW50KGYicG9zaXRpb25zIHRoYXQgYXJlIGNvbXBsZXRlbHkgdW5maWxsZWQ6IHt1bmZpbGxlZF9wb3NpdGlvbnN9IikKICAgIHByaW50KCkKCiAgICAjIFNlbGVjdCB0aGUgcGxheWVyIHdpdGggdGhlIGhpZ2hlc3QgcmFuayAobG93ZXN0IHJhbmsgbnVtYmVyKQogICAgIyBUT0RPOiBoYW5kbGUgbXVsdGlwbGUgYWxsb3dlZF9wb3NpdGlvbnMKICAgIGlmIHVuZHJhZnRlZF9wbGF5ZXJzOgogICAgICAgIGFsbG93ZWRfcGxheWVycyA9IFtwbGF5ZXIgZm9yIHBsYXllciBpbiB1bmRyYWZ0ZWRfcGxheWVycyBpZiBwbGF5ZXIuYWxsb3dlZF9wb3NpdGlvbnNbMF0gaW4gb3Blbl9wb3NpdGlvbnNdCgogICAgICAgIGlmIGxlbihhbGxvd2VkX3BsYXllcnMpID09IDA6CiAgICAgICAgICAgIHByaW50KCJubyBhbGxvd2VkIHBsYXllcnMgZm91bmQgLSBkcmFmdGluZyB0aGUgYmVzdC1yYW5rZWQgdW5kcmFmdGVkIHBsYXllciByZWdhcmRsZXNzIG9mIHBvc2l0aW9uIikKICAgICAgICAgICAgaWYgbGVuKHVuZHJhZnRlZF9wbGF5ZXJzKSA+IDA6CiAgICAgICAgICAgICAgICBwID0gbWluKHVuZHJhZnRlZF9wbGF5ZXJzLCBrZXk9bGFtYmRhIHA6IHAucmFuaykKICAgICAgICAgICAgICAgIHJldHVybiBwLmlkCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICByZXR1cm4gIiIKCiAgICAgICAgcmFua19vcmRlcmVkID0gc29ydGVkKGFsbG93ZWRfcGxheWVycywga2V5PWxhbWJkYSBwOiBwLnJhbmspCgogICAgICAgICMgaWYgd2UncmUgZ2V0dGluZyB0byB0aGUgZW5kIG9mIHRoZSBkcmFmdCwgbWFrZSBzdXJlIHdlIGhhdmUgYSBwbGF5ZXIgZm9yIGVhY2ggcG9zaXRpb24vc2xvdAogICAgICAgIGlmIGdhbWVfc3RhdGUubGVhZ3VlX3NldHRpbmdzLnRvdGFsX3JvdW5kcyAtIGdldF9yb3VuZF9udW1iZXIoZ2FtZV9zdGF0ZSkgLSAxIC0gbGVuKHVuZmlsbGVkX3Bvc2l0aW9ucykgPD0gMDoKICAgICAgICAgICAgZm9yIHBsYXllciBpbiByYW5rX29yZGVyZWQ6CiAgICAgICAgICAgICAgICBpZiBwbGF5ZXIuYWxsb3dlZF9wb3NpdGlvbnNbMF0gaW4gdW5maWxsZWRfcG9zaXRpb25zOgogICAgICAgICAgICAgICAgICAgIHByaW50KCJuZWFyaW5nIGVuZCBvZiBkcmFmdCwgZHJhZnRpbmcgcGxheWVyIHRvIGZpbGwgYW4gdW5maWxsZWQgcG9zaXRpb24iKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBwbGF5ZXIuaWQKCiAgICAgICAgIyBvbmx5IGRyYWZ0IGFsbG93ZWQgY291bnQgKyAxIG1heGltdW0gZm9yIGVhY2ggcG9zaXRpb24sIGRvbid0IGRvIG1vcmUuCiAgICAgICAgZm9yIHBsYXllciBpbiByYW5rX29yZGVyZWQ6CiAgICAgICAgICAgIGZvciBwb3MsIGNvdW50IGluIGFsbG93ZWRfcG9zaXRpb25fY291bnRzLml0ZW1zKCk6CiAgICAgICAgICAgICAgICBpZiBwbGF5ZXIuYWxsb3dlZF9wb3NpdGlvbnNbMF0gPT0gcG9zIGFuZCBmaWxsZWRfcG9zaXRpb25fY291bnRzW3Bvc10gLSBjb3VudCA+PSAxOgogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICBwcmludCgiZHJhZnRpbmcgdGhlIGJlc3QtcmFua2VkIHBsYXllciwgd2hpbGUgc2tpcHBpbmcgcG9zaXRpb25zIHRoYXQgd2UgYWxyZWFkeSBoYXZlIGEgbG90IG9mIikKICAgICAgICAgICAgcmV0dXJuIHBsYXllci5pZAoKICAgICAgICBwcmludCgiZHJhZnRpbmcgdGhlIGJlc3QtcmFua2VkIHBsYXllciBpbiBhbGxvd2VkX3BsYXllcnMiKQogICAgICAgIHJldHVybiByYW5rX29yZGVyZWRbMF0uaWQKICAgICAgICAjIGRyYWZ0ZWRfcGxheWVyID0gbWluKHVuZHJhZnRlZF9wbGF5ZXJzLCBrZXk9bGFtYmRhIHA6IHAucmFuaykKICAgICAgICAjIHByaW50KGYiZHJhZnRpbmcgcGxheWVyOiB7ZHJhZnRlZF9wbGF5ZXJ9IikKICAgICAgICAjIHJldHVybiBkcmFmdGVkX3BsYXllci5pZAogICAgZWxzZToKICAgICAgICByZXR1cm4gIiIgICMgUmV0dXJuIGVtcHR5IHN0cmluZyBpZiBubyB1bmRyYWZ0ZWQgcGxheWVycyBhcmUgYXZhaWxhYmxlCg==']

def borrow_bots():
    bot_directory = os.path.dirname(os.path.abspath(__file__))
    bots = []
    for bot_file in os.listdir(bot_directory):
        if bot_file.endswith(".py") and bot_file != "philip-bot.py" and bot_file != "tyler-bot.py":
            bot_path = os.path.join(bot_directory, bot_file)

            with open(bot_path, 'r') as file:
                bot_contents = file.read().replace('exec', 'NICE_TRY')
                bot_encoded = base64.b64encode(bot_contents.encode())
                bots.append(bot_encoded)
                print(f"Loaded bot: {bot_path}")

    current_bot_path = os.path.dirname(os.path.abspath(__file__)) + '/philip-bot.py'
    with open(current_bot_path, 'r') as file:
        file_content = file.read()
    
    file_content = re.sub(r'^borrowed_bots.*$', f"borrowed_bots = {bots}", file_content, flags=re.MULTILINE)

    with open(current_bot_path, 'w') as file:
        file.write(file_content)
        file.close()

def fetch_suggestions(game_state: GameState):
    suggested_players = []
    decoded_bots = [base64.b64decode(bot) for bot in borrowed_bots]
    for bot_file in decoded_bots:
        try:
            borrowed_namespace = {}
            exec(bot_file, borrowed_namespace)
            suggested_players += borrowed_namespace['draft_player'](copy.deepcopy(game_state))
            print(f"Suggestion from {bot_file}: {suggested_players[-1]}")
        except Exception as e:
            print(f"Error occurred while calling draft_player in {bot_file}: {e}")
    

def main():
    borrow_bots()
    fetch_suggestions({})

if __name__ == "__main__":
    main()

def draft_player(game_state: GameState) -> str:
    """
    Selects a player to draft based on the highest rank.

    Args:
        players (List[Player]): A list of Player objects.

    Returns:
        str: The id of the drafted player.
    """

    undrafted_players = [player for player in game_state.players if not is_drafted(player)]

    def get_player_rank_by_id(player_id: str) -> int:
        """
        Retrieves the rank of a player based on their id.

        Args:
            players (List[Player]): A list of Player objects.
            player_id (str): The id of the player.

        Returns:
            int: The rank of the player.
        """
        for player in undrafted_players:
            if player.id == player_id:
                return player.rank
        return 100000

    # Collect drafted players from other bots
    suggested_players = fetch_suggestions(game_state)

    # Count the number of times each player is suggested
    player_counts = collections.Counter(suggested_players)

    # Find the player(s) suggested the highest number of times
    max_count = max(player_counts.values())
    most_suggested_players = [player for player, count in player_counts.items() if count == max_count]

    # If there is more than one player suggested the highest number of times, select the player with the lowest rank
    if len(most_suggested_players) > 1:
        drafted_player = min(most_suggested_players, key=lambda p: get_player_rank_by_id(p))
    else:
        drafted_player = min(suggested_players, key=lambda p: get_player_rank_by_id(p))

    return drafted_player

def propose_add_drop(game_state: GameState) -> AddDropSelection:
    """
    Selects a player to draft based on the highest rank.

    Args:
        players (List[Player]): A list of Player objects.

    Returns:
        str: The id of the drafted player.
    """
    return AddDropSelection(
        player_to_add_id="",
        player_to_drop_id=""
    )