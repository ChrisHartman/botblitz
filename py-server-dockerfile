FROM ubuntu:22.04

RUN apt-get update -y && \
    apt-get install -y python3 python3-pip

WORKDIR /app

# Copy only the built wheel file
COPY dist/blitz_env-0.1.0-py3-none-any.whl /app/

# Copy only the py_grpc_server directory
COPY py_grpc_server /app/py_grpc_server

# Copy over the requirements file for the repo
COPY requirements.txt /app/py_grpc_server/requirements.txt

# Install the local wheel
RUN pip3 install blitz_env-0.1.0-py3-none-any.whl

# Install other requirements
RUN pip3 install -r py_grpc_server/requirements.txt

RUN chmod +x /app/py_grpc_server/bootstrap.sh

EXPOSE 8080

WORKDIR /app/py_grpc_server

CMD ["/app/py_grpc_server/bootstrap.sh"]